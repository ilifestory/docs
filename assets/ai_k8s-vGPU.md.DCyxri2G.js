import{_ as s,c as n,o as a,a4 as l}from"./chunks/framework.CCJHkvW2.js";const b=JSON.parse('{"title":"","description":"","frontmatter":{},"headers":[],"relativePath":"ai/k8s-vGPU.md","filePath":"ai/k8s-vGPU.md","lastUpdated":1707212135000}'),e={name:"ai/k8s-vGPU.md"},p=l(`<h2 id="安装nvidia-container-toolkit-推荐" tabindex="-1">安装nvidia-container-toolkit（推荐） <a class="header-anchor" href="#安装nvidia-container-toolkit-推荐" aria-label="Permalink to &quot;安装nvidia-container-toolkit（推荐）&quot;">​</a></h2><div class="language-shell line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">shell</span><pre class="shiki material-theme-palenight vp-code" tabindex="0"><code><span class="line"><span style="color:#676E95;font-style:italic;">#复制一份docker配置文件,以防被覆盖</span></span>
<span class="line"><span style="color:#FFCB6B;">cp</span><span style="color:#C3E88D;"> /etc/docker/daemon.json</span><span style="color:#C3E88D;"> /etc/docker/daemon.json.bak</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><p>根据官网步骤安装nvidia-container-toolkit</p><p><a href="https://docs.nvidia.com/datacenter/cloud-native/container-toolkit/latest/install-guide.html#installing-with-yum-or-dnf" target="_blank" rel="noreferrer">container-toolkit.html</a></p><p>下载仓库并安装NVIDIA Container Toolkit</p><div class="language-shell line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">shell</span><pre class="shiki material-theme-palenight vp-code" tabindex="0"><code><span class="line"><span style="color:#FFCB6B;">curl</span><span style="color:#C3E88D;"> -s</span><span style="color:#C3E88D;"> -L</span><span style="color:#C3E88D;"> https://nvidia.github.io/libnvidia-container/stable/rpm/nvidia-container-toolkit.repo</span><span style="color:#89DDFF;"> |</span><span style="color:#BABED8;"> \\</span></span>
<span class="line"><span style="color:#FFCB6B;">tee</span><span style="color:#C3E88D;"> /etc/yum.repos.d/nvidia-container-toolkit.repo</span><span style="color:#89DDFF;"> |</span><span style="color:#BABED8;">\\</span></span>
<span class="line"><span style="color:#FFCB6B;">yum-config-manager</span><span style="color:#C3E88D;"> --enable</span><span style="color:#C3E88D;"> nvidia-container-toolkit-experimental</span><span style="color:#89DDFF;"> |</span><span style="color:#BABED8;"> \\</span></span>
<span class="line"><span style="color:#FFCB6B;">yum</span><span style="color:#C3E88D;"> install</span><span style="color:#C3E88D;"> -y</span><span style="color:#C3E88D;"> nvidia-container-toolkit</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div></div><p>打开/etc/docker/daemon.json,配置如下</p><div class="language-shell line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">shell</span><pre class="shiki material-theme-palenight vp-code" tabindex="0"><code><span class="line"><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#FFCB6B;">    &quot;registry-mirrors&quot;</span><span style="color:#82AAFF;">:</span><span style="color:#BABED8;"> [</span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">https://82m9ar63.mirror.aliyuncs.com</span><span style="color:#89DDFF;">&quot;</span><span style="color:#BABED8;">],</span></span>
<span class="line"><span style="color:#FFCB6B;">    &quot;exec-opts&quot;</span><span style="color:#82AAFF;">:</span><span style="color:#BABED8;"> [</span></span>
<span class="line"><span style="color:#FFCB6B;">        &quot;native.cgroupdriver=systemd&quot;</span></span>
<span class="line"><span style="color:#BABED8;">    ],</span></span>
<span class="line"><span style="color:#FFCB6B;">    &quot;insecure-registries&quot;</span><span style="color:#82AAFF;">:</span><span style="color:#BABED8;"> [</span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">172.26.25.7:8070</span><span style="color:#89DDFF;">&quot;</span><span style="color:#BABED8;">],</span></span>
<span class="line"><span style="color:#FFCB6B;">    &quot;default-runtime&quot;</span><span style="color:#82AAFF;">:</span><span style="color:#89DDFF;"> &quot;</span><span style="color:#C3E88D;">nvidia</span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">,</span></span>
<span class="line"><span style="color:#FFCB6B;">    &quot;runtimes&quot;</span><span style="color:#82AAFF;">:</span><span style="color:#C3E88D;"> {</span></span>
<span class="line"><span style="color:#FFCB6B;">        &quot;nvidia&quot;</span><span style="color:#82AAFF;">:</span><span style="color:#C3E88D;"> {</span></span>
<span class="line"><span style="color:#FFCB6B;">            &quot;runtimeArgs&quot;</span><span style="color:#82AAFF;">:</span><span style="color:#BABED8;"> [],</span></span>
<span class="line"><span style="color:#FFCB6B;">            &quot;path&quot;</span><span style="color:#82AAFF;">:</span><span style="color:#89DDFF;"> &quot;</span><span style="color:#C3E88D;">/usr/bin/nvidia-container-runtime</span><span style="color:#89DDFF;">&quot;</span></span>
<span class="line"><span style="color:#89DDFF;">        }</span></span>
<span class="line"><span style="color:#BABED8;">    }</span></span>
<span class="line"><span style="color:#BABED8;">}</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br></div></div><h2 id="然后重新载入daemon并重启docker" tabindex="-1">然后重新载入daemon并重启docker <a class="header-anchor" href="#然后重新载入daemon并重启docker" aria-label="Permalink to &quot;然后重新载入daemon并重启docker&quot;">​</a></h2><div class="language-shell line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">shell</span><pre class="shiki material-theme-palenight vp-code" tabindex="0"><code><span class="line"><span style="color:#FFCB6B;">systemctl</span><span style="color:#C3E88D;"> daemon-reload</span></span>
<span class="line"><span style="color:#FFCB6B;">systemctl</span><span style="color:#C3E88D;"> restart</span><span style="color:#C3E88D;"> docker</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><h2 id="查看当前docker默认运行时" tabindex="-1">查看当前docker默认运行时 <a class="header-anchor" href="#查看当前docker默认运行时" aria-label="Permalink to &quot;查看当前docker默认运行时&quot;">​</a></h2><div class="language-shell line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">shell</span><pre class="shiki material-theme-palenight vp-code" tabindex="0"><code><span class="line"><span style="color:#FFCB6B;">docker</span><span style="color:#C3E88D;"> info</span><span style="color:#89DDFF;"> |</span><span style="color:#FFCB6B;"> grep</span><span style="color:#C3E88D;"> -i</span><span style="color:#89DDFF;"> &#39;</span><span style="color:#C3E88D;">Default Runtime</span><span style="color:#89DDFF;">&#39;</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br></div></div><h2 id="先打两个标签" tabindex="-1">先打两个标签 <a class="header-anchor" href="#先打两个标签" aria-label="Permalink to &quot;先打两个标签&quot;">​</a></h2><div class="language-shell line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">shell</span><pre class="shiki material-theme-palenight vp-code" tabindex="0"><code><span class="line"><span style="color:#FFCB6B;">kubectl</span><span style="color:#C3E88D;"> label</span><span style="color:#C3E88D;"> nodes</span><span style="color:#C3E88D;"> k8s-node-5-rtx3090</span><span style="color:#C3E88D;"> gpu=on</span><span style="color:#676E95;font-style:italic;">           # k8s-master-rtx4090：node id</span></span>
<span class="line"><span style="color:#FFCB6B;">kubectl</span><span style="color:#C3E88D;"> label</span><span style="color:#C3E88D;"> nodes</span><span style="color:#C3E88D;"> k8s-node-5-rtx3090</span><span style="color:#C3E88D;"> gpu-type=rtx3090</span><span style="color:#676E95;font-style:italic;">  # gpu-node=k8s-master-rtx4090自定义标签，方便gpu节点分配</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><h2 id="基于helm的k8s-vgpu-scheduler" tabindex="-1">基于<code>helm</code>的<code>k8s-vgpu-scheduler</code> <a class="header-anchor" href="#基于helm的k8s-vgpu-scheduler" aria-label="Permalink to &quot;基于\`helm\`的\`k8s-vgpu-scheduler\`&quot;">​</a></h2><h3 id="安装helm" tabindex="-1">安装<code>helm</code> <a class="header-anchor" href="#安装helm" aria-label="Permalink to &quot;安装\`helm\`&quot;">​</a></h3><div class="language-shell line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">shell</span><pre class="shiki material-theme-palenight vp-code" tabindex="0"><code><span class="line"><span style="color:#FFCB6B;">mkdir</span><span style="color:#C3E88D;"> -p</span><span style="color:#C3E88D;"> /usr/local/helm</span></span>
<span class="line"><span style="color:#82AAFF;">cd</span><span style="color:#C3E88D;"> /usr/local/helm</span></span>
<span class="line"><span style="color:#FFCB6B;">wget</span><span style="color:#C3E88D;"> https://get.helm.sh/helm-v3.10.0-linux-amd64.tar.gz</span></span>
<span class="line"><span style="color:#FFCB6B;">wget</span><span style="color:#C3E88D;"> http://172.26.25.16:7000/vgpu/vgpu-share/helm-v3.10.0-linux-amd64.tar.gz</span><span style="color:#676E95;font-style:italic;">  #内部下载更快 </span></span>
<span class="line"><span style="color:#FFCB6B;">tar</span><span style="color:#C3E88D;"> zxvf</span><span style="color:#C3E88D;"> helm-v3.10.0-linux-amd64.tar.gz</span></span>
<span class="line"><span style="color:#FFCB6B;">mv</span><span style="color:#C3E88D;"> -f</span><span style="color:#C3E88D;"> linux-amd64/helm</span><span style="color:#C3E88D;"> /usr/bin</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br></div></div><h3 id="查看kubernetes版本命令" tabindex="-1">查看<code>Kubernetes</code>版本命令 <a class="header-anchor" href="#查看kubernetes版本命令" aria-label="Permalink to &quot;查看\`Kubernetes\`版本命令&quot;">​</a></h3><div class="language-shell line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">shell</span><pre class="shiki material-theme-palenight vp-code" tabindex="0"><code><span class="line"><span style="color:#FFCB6B;">kubectl</span><span style="color:#C3E88D;"> version</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br></div></div><div class="language-text line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">text</span><pre class="shiki material-theme-palenight vp-code" tabindex="0"><code><span class="line"><span>Client Version: version.Info{Major:&quot;1&quot;, Minor:&quot;23&quot;, GitVersion:&quot;v1.23.6&quot;, GitCommit:&quot;ad3338546da947756e8a88aa6822e9c11e7eac22&quot;, GitTreeState:&quot;clean&quot;, BuildDate:&quot;2022-04-14T08:49:13Z&quot;, GoVersion:&quot;go1.17.9&quot;, Compiler:&quot;gc&quot;, Platform:&quot;linux/amd64&quot;}</span></span>
<span class="line"><span></span></span>
<span class="line"><span>Server Version: version.Info{Major:&quot;1&quot;, Minor:&quot;23&quot;, GitVersion:&quot;v1.23.6&quot;, GitCommit:&quot;ad3338546da947756e8a88aa6822e9c11e7eac22&quot;, GitTreeState:&quot;clean&quot;, BuildDate:&quot;2022-04-14T08:43:11Z&quot;, GoVersion:&quot;go1.17.9&quot;, Compiler:&quot;gc&quot;, Platform:&quot;linux/amd64&quot;}</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div><h3 id="使用helm添加第四范式-k8s-vgpu-scheduler的repo" tabindex="-1">使用helm添加第四范式 <code>k8s-vgpu-scheduler</code>的repo <a class="header-anchor" href="#使用helm添加第四范式-k8s-vgpu-scheduler的repo" aria-label="Permalink to &quot;使用helm添加第四范式 \`k8s-vgpu-scheduler\`的repo&quot;">​</a></h3><p>自动执行</p><div class="language-shell line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">shell</span><pre class="shiki material-theme-palenight vp-code" tabindex="0"><code><span class="line"><span style="color:#FFCB6B;">helm</span><span style="color:#C3E88D;"> repo</span><span style="color:#C3E88D;"> remove</span><span style="color:#C3E88D;"> vgpu-charts</span></span>
<span class="line"><span style="color:#FFCB6B;">helm</span><span style="color:#C3E88D;"> repo</span><span style="color:#C3E88D;"> add</span><span style="color:#C3E88D;"> vgpu-charts</span><span style="color:#C3E88D;"> https://4paradigm.github.io/k8s-vgpu-scheduler</span></span>
<span class="line"><span style="color:#FFCB6B;">helm</span><span style="color:#C3E88D;"> repo</span><span style="color:#C3E88D;"> update</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div><div class="language-shell line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">shell</span><pre class="shiki material-theme-palenight vp-code" tabindex="0"><code><span class="line"><span style="color:#FFCB6B;">helm</span><span style="color:#C3E88D;"> install</span><span style="color:#C3E88D;"> -n</span><span style="color:#C3E88D;"> vgpu</span><span style="color:#C3E88D;"> vgpu-charts/vgpu</span><span style="color:#C3E88D;"> --set</span><span style="color:#C3E88D;"> scheduler.kubeScheduler.imageTag=v1.23.6</span><span style="color:#C3E88D;"> --namespace</span><span style="color:#C3E88D;"> kube-system</span><span style="color:#C3E88D;"> --generate-name</span><span style="color:#C3E88D;"> --set</span><span style="color:#C3E88D;"> devicePlugin.deviceMemoryScaling=</span><span style="color:#F78C6C;">1</span><span style="color:#C3E88D;"> --set</span><span style="color:#C3E88D;"> devicePlugin.deviceSplitCount=</span><span style="color:#F78C6C;">4</span><span style="color:#C3E88D;"> --set</span><span style="color:#C3E88D;"> scheduler.defaultMem=</span><span style="color:#F78C6C;">2048</span><span style="color:#C3E88D;"> --set</span><span style="color:#C3E88D;"> scheduler.defaultCores=</span><span style="color:#F78C6C;">0</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br></div></div><p>手动从源码执行</p><div class="language-shell line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">shell</span><pre class="shiki material-theme-palenight vp-code" tabindex="0"><code><span class="line"><span style="color:#676E95;font-style:italic;"># clone repo，然后在{repo path}/charts/ 目录下执行</span></span>
<span class="line"><span style="color:#FFCB6B;">helm</span><span style="color:#C3E88D;"> install</span><span style="color:#C3E88D;"> -n</span><span style="color:#C3E88D;"> vgpu</span><span style="color:#C3E88D;"> vgpu</span><span style="color:#C3E88D;"> --set</span><span style="color:#C3E88D;"> scheduler.kubeScheduler.imageTag=v1.23.6</span><span style="color:#BABED8;"> \\</span></span>
<span class="line"><span style="color:#BABED8;">--namespace </span><span style="color:#C3E88D;">kube-system</span><span style="color:#C3E88D;"> --generate-name</span><span style="color:#C3E88D;"> --set</span><span style="color:#C3E88D;"> devicePlugin.deviceMemoryScaling=</span><span style="color:#F78C6C;">1</span><span style="color:#BABED8;"> \\</span></span>
<span class="line"><span style="color:#BABED8;">--set </span><span style="color:#C3E88D;">devicePlugin.deviceSplitCount=</span><span style="color:#F78C6C;">4</span><span style="color:#C3E88D;"> --set</span><span style="color:#C3E88D;"> scheduler.defaultMem=</span><span style="color:#F78C6C;">2048</span><span style="color:#BABED8;"> \\</span></span>
<span class="line"><span style="color:#BABED8;">--set </span><span style="color:#C3E88D;">scheduler.defaultCores=</span><span style="color:#F78C6C;">0</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br></div></div><div class="tip custom-block"><p class="custom-block-title">参数说明</p><p>scheduler.kubeScheduler.imageTag:Kubernetes版本</p><p>devicePlugin.deviceMemoryScaling:浮点数类型，预设值是1。NVIDIA装置显存使用比例，可以大于1（启用虚拟显存，实验功能）。对于有M显存大小的NVIDIA GPU，如果我们配置devicePlugin.deviceMemoryScaling参数为S，在部署了我们装置插件的Kubenetes集群中，这张GPU分出的vGPU将总共包含 S * M 显存</p><p>devicePlugin.deviceSplitCount:GPU的分割数</p><p>devicePlugin.disablecorelimit: 字符串类型，&quot;true&quot;为关闭算力限制，&quot;false&quot;为启动算力限制，默认为&quot;false&quot;</p><p>scheduler.defaultMem: 整数类型，预设值为5000，表示不配置显存时使用的默认显存大小，单位为MB</p><p>scheduler.defaultCores: 整数类型(0-100)，默认为0，表示默认为每个任务预留的百分比算力。若设置为0，则代表任务可能会被分配到任一满足显存需求的GPU中，若设置为100，代表该任务独享整张显卡</p></div><h2 id="查看pod分配情况" tabindex="-1">查看pod分配情况 <a class="header-anchor" href="#查看pod分配情况" aria-label="Permalink to &quot;查看pod分配情况&quot;">​</a></h2><div class="language-shell line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">shell</span><pre class="shiki material-theme-palenight vp-code" tabindex="0"><code><span class="line"><span style="color:#FFCB6B;">kubectl</span><span style="color:#C3E88D;"> describe</span><span style="color:#C3E88D;"> node</span><span style="color:#C3E88D;"> xxxxxxxxx</span><span style="color:#89DDFF;"> |</span><span style="color:#FFCB6B;"> grep</span><span style="color:#C3E88D;"> gpu</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br></div></div><div class="language-text line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">text</span><pre class="shiki material-theme-palenight vp-code" tabindex="0"><code><span class="line"><span># nvidia.com/gpu:     4</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br></div></div><h2 id="测试yaml-pod" tabindex="-1">测试yaml pod <a class="header-anchor" href="#测试yaml-pod" aria-label="Permalink to &quot;测试yaml pod&quot;">​</a></h2><div class="language-yaml line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">yaml</span><pre class="shiki material-theme-palenight vp-code" tabindex="0"><code><span class="line"><span style="color:#F07178;">apiVersion</span><span style="color:#89DDFF;">:</span><span style="color:#C3E88D;"> batch/v1</span></span>
<span class="line"><span style="color:#F07178;">kind</span><span style="color:#89DDFF;">:</span><span style="color:#C3E88D;"> Job</span></span>
<span class="line"><span style="color:#F07178;">metadata</span><span style="color:#89DDFF;">:</span></span>
<span class="line"><span style="color:#F07178;">  name</span><span style="color:#89DDFF;">:</span><span style="color:#C3E88D;"> gpu-deploy-job</span></span>
<span class="line"><span style="color:#F07178;">spec</span><span style="color:#89DDFF;">:</span></span>
<span class="line"><span style="color:#F07178;">  backoffLimit</span><span style="color:#89DDFF;">:</span><span style="color:#F78C6C;"> 3</span></span>
<span class="line"><span style="color:#676E95;font-style:italic;">  # 行运的Pod的个数，默认为1</span></span>
<span class="line"><span style="color:#F07178;">  parallelism</span><span style="color:#89DDFF;">:</span><span style="color:#F78C6C;"> 1</span></span>
<span class="line"><span style="color:#676E95;font-style:italic;">  # Job结束需要成功运行的Pod个数，不设置 spec.completions，默认值为 spec.parallelism 若都未设置默认全为1</span></span>
<span class="line"><span style="color:#F07178;">  completions</span><span style="color:#89DDFF;">:</span><span style="color:#F78C6C;"> 1</span></span>
<span class="line"><span style="color:#676E95;font-style:italic;">  # 10秒后清除job Completed 或 Terminating</span></span>
<span class="line"><span style="color:#F07178;">  ttlSecondsAfterFinished</span><span style="color:#89DDFF;">:</span><span style="color:#F78C6C;"> 10</span></span>
<span class="line"><span style="color:#F07178;">  template</span><span style="color:#89DDFF;">:</span></span>
<span class="line"><span style="color:#F07178;">    metadata</span><span style="color:#89DDFF;">:</span></span>
<span class="line"><span style="color:#F07178;">      name</span><span style="color:#89DDFF;">:</span><span style="color:#C3E88D;"> gpu-deploy-job</span></span>
<span class="line"><span style="color:#F07178;">    spec</span><span style="color:#89DDFF;">:</span></span>
<span class="line"><span style="color:#F07178;">      containers</span><span style="color:#89DDFF;">:</span></span>
<span class="line"><span style="color:#89DDFF;">      -</span><span style="color:#F07178;"> name</span><span style="color:#89DDFF;">:</span><span style="color:#C3E88D;"> gpu-deploy-job</span></span>
<span class="line"><span style="color:#F07178;">        image</span><span style="color:#89DDFF;">:</span><span style="color:#C3E88D;"> 172.26.25.7:8070/custom/nvidia-cuda-11.8-cudnn8:nvidia-cuda-11.8-cudnn8-torch-tensorflow</span></span>
<span class="line"><span style="color:#676E95;font-style:italic;">        # IfNotPresent </span></span>
<span class="line"><span style="color:#F07178;">        imagePullPolicy</span><span style="color:#89DDFF;">:</span><span style="color:#C3E88D;"> Always</span></span>
<span class="line"><span style="color:#F07178;">        volumeMounts</span><span style="color:#89DDFF;">:</span></span>
<span class="line"><span style="color:#89DDFF;">          -</span><span style="color:#F07178;"> name</span><span style="color:#89DDFF;">:</span><span style="color:#C3E88D;"> source-code</span></span>
<span class="line"><span style="color:#F07178;">            mountPath</span><span style="color:#89DDFF;">:</span><span style="color:#C3E88D;"> /source-code</span></span>
<span class="line"><span style="color:#F07178;">        resources</span><span style="color:#89DDFF;">:</span></span>
<span class="line"><span style="color:#F07178;">          requests</span><span style="color:#89DDFF;">:</span></span>
<span class="line"><span style="color:#F07178;">            cpu</span><span style="color:#89DDFF;">:</span><span style="color:#F78C6C;"> 0.5</span></span>
<span class="line"><span style="color:#F07178;">            memory</span><span style="color:#89DDFF;">:</span><span style="color:#C3E88D;"> 512Mi</span></span>
<span class="line"><span style="color:#F07178;">            nvidia.com/gpu</span><span style="color:#89DDFF;">:</span><span style="color:#F78C6C;"> 1</span></span>
<span class="line"><span style="color:#F07178;">            nvidia.com/gpumem</span><span style="color:#89DDFF;">:</span><span style="color:#F78C6C;"> 2048</span></span>
<span class="line"><span style="color:#F07178;">          limits</span><span style="color:#89DDFF;">:</span></span>
<span class="line"><span style="color:#F07178;">            cpu</span><span style="color:#89DDFF;">:</span><span style="color:#F78C6C;"> 1</span></span>
<span class="line"><span style="color:#F07178;">            memory</span><span style="color:#89DDFF;">:</span><span style="color:#C3E88D;"> 1024Mi</span></span>
<span class="line"><span style="color:#F07178;">            nvidia.com/gpu</span><span style="color:#89DDFF;">:</span><span style="color:#F78C6C;"> 1</span></span>
<span class="line"><span style="color:#F07178;">            nvidia.com/gpumem</span><span style="color:#89DDFF;">:</span><span style="color:#F78C6C;"> 2048</span></span>
<span class="line"><span style="color:#F07178;">        command</span><span style="color:#89DDFF;">:</span><span style="color:#89DDFF;"> [</span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">/bin/sh</span><span style="color:#89DDFF;">&quot;</span><span style="color:#89DDFF;">,</span><span style="color:#89DDFF;">  &quot;</span><span style="color:#C3E88D;">-c</span><span style="color:#89DDFF;">&quot;</span><span style="color:#89DDFF;">,</span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">echo hello world &amp;&amp; sleep 60</span><span style="color:#89DDFF;">&quot;</span><span style="color:#89DDFF;">]</span></span>
<span class="line"><span style="color:#676E95;font-style:italic;">        #command: [&quot;/bin/sh&quot;,  &quot;-c&quot;,&quot;echo hello world;sleep 30;&quot;]</span></span>
<span class="line"><span style="color:#676E95;font-style:italic;">      # job仅支持Never或OnFailure</span></span>
<span class="line"><span style="color:#F07178;">      restartPolicy</span><span style="color:#89DDFF;">:</span><span style="color:#C3E88D;"> OnFailure</span></span>
<span class="line"><span style="color:#F07178;">      volumes</span><span style="color:#89DDFF;">:</span></span>
<span class="line"><span style="color:#89DDFF;">        -</span><span style="color:#F07178;"> name</span><span style="color:#89DDFF;">:</span><span style="color:#C3E88D;"> source-code</span></span>
<span class="line"><span style="color:#F07178;">          hostPath</span><span style="color:#89DDFF;">:</span></span>
<span class="line"><span style="color:#F07178;">            path</span><span style="color:#89DDFF;">:</span><span style="color:#C3E88D;"> /zhangling/source-code</span></span>
<span class="line"><span style="color:#F07178;">      nodeSelector</span><span style="color:#89DDFF;">:</span></span>
<span class="line"><span style="color:#F07178;">        gpu-type</span><span style="color:#89DDFF;">:</span><span style="color:#89DDFF;"> &quot;</span><span style="color:#C3E88D;">rtx4090</span><span style="color:#89DDFF;">&quot;</span></span>
<span class="line"></span>
<span class="line"></span>
<span class="line"><span style="color:#676E95;font-style:italic;"># &quot;nvidia.com/gpu&quot;:字符串类型, 申请vgpu个数的资源名</span></span>
<span class="line"><span style="color:#676E95;font-style:italic;"># &quot;nvidia.com/gpumem&quot;:字符串类型, 申请vgpu显存大小资源名</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br><span class="line-number">39</span><br><span class="line-number">40</span><br><span class="line-number">41</span><br><span class="line-number">42</span><br><span class="line-number">43</span><br><span class="line-number">44</span><br><span class="line-number">45</span><br><span class="line-number">46</span><br><span class="line-number">47</span><br><span class="line-number">48</span><br><span class="line-number">49</span><br></div></div><h3 id="进入测试yaml-pod" tabindex="-1">进入测试yaml pod <a class="header-anchor" href="#进入测试yaml-pod" aria-label="Permalink to &quot;进入测试yaml pod&quot;">​</a></h3><div class="language-shell line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">shell</span><pre class="shiki material-theme-palenight vp-code" tabindex="0"><code><span class="line"><span style="color:#FFCB6B;">nvidia-smi</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br></div></div><div class="language-text line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">text</span><pre class="shiki material-theme-palenight vp-code" tabindex="0"><code><span class="line"><span>+---------------------------------------------------------------------------------------+</span></span>
<span class="line"><span>| NVIDIA-SMI 535.154.05             Driver Version: 535.154.05   CUDA Version: 12.2     |</span></span>
<span class="line"><span>|-----------------------------------------+----------------------+----------------------+</span></span>
<span class="line"><span>| GPU  Name                 Persistence-M | Bus-Id        Disp.A | Volatile Uncorr. ECC |</span></span>
<span class="line"><span>| Fan  Temp   Perf          Pwr:Usage/Cap |         Memory-Usage | GPU-Util  Compute M. |</span></span>
<span class="line"><span>|                                         |                      |               MIG M. |</span></span>
<span class="line"><span>|=========================================+======================+======================|</span></span>
<span class="line"><span>|   0  NVIDIA GeForce RTX 3090        Off | 00000000:01:00.0 Off |                  N/A |</span></span>
<span class="line"><span>| 32%   18C    P8               9W / 350W |      0MiB / 2048MiB |      0%      Default |</span></span>
<span class="line"><span>|                                         |                      |                  N/A |</span></span>
<span class="line"><span>+-----------------------------------------+----------------------+----------------------+</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br></div></div>`,35),o=[p];function r(t,c,i,u,d,y){return a(),n("div",null,o)}const F=s(e,[["render",r]]);export{b as __pageData,F as default};
