import{_ as s,c as a,o as n,a4 as e}from"./chunks/framework.CCJHkvW2.js";const u=JSON.parse('{"title":"Mysql","description":"","frontmatter":{},"headers":[],"relativePath":"db/mysql.md","filePath":"db/mysql.md","lastUpdated":1708482714000}'),l={name:"db/mysql.md"},p=e(`<h1 id="mysql" tabindex="-1">Mysql <a class="header-anchor" href="#mysql" aria-label="Permalink to &quot;Mysql&quot;">​</a></h1><h2 id="安装" tabindex="-1">安装 <a class="header-anchor" href="#安装" aria-label="Permalink to &quot;安装&quot;">​</a></h2><div class="language-bash line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki material-theme-palenight vp-code" tabindex="0"><code><span class="line"><span style="color:#FFCB6B;">docker</span><span style="color:#C3E88D;"> run</span><span style="color:#C3E88D;"> --name</span><span style="color:#C3E88D;"> zhangling-mysql</span><span style="color:#C3E88D;"> --restart=always</span><span style="color:#C3E88D;"> -v</span><span style="color:#C3E88D;"> /docker/mysql/conf:/etc/mysql/conf.d</span><span style="color:#C3E88D;"> -v</span><span style="color:#C3E88D;"> /docker/mysql/logs:/logs</span><span style="color:#BABED8;"> </span></span>
<span class="line"><span style="color:#FFCB6B;">-v</span><span style="color:#C3E88D;"> /docker/mysql/data:/var/lib/mysql</span><span style="color:#C3E88D;"> -e</span><span style="color:#C3E88D;"> MYSQL_ROOT_PASSWORD=Zhangling@</span><span style="color:#C3E88D;"> -e</span><span style="color:#C3E88D;"> TZ=Asia/Shanghai</span><span style="color:#C3E88D;"> -d</span><span style="color:#C3E88D;"> -i</span><span style="color:#C3E88D;"> -p</span><span style="color:#C3E88D;"> 3306:3306</span><span style="color:#C3E88D;"> mysql:latest</span></span>
<span class="line"></span>
<span class="line"><span style="color:#FFCB6B;">docker</span><span style="color:#C3E88D;"> exec</span><span style="color:#C3E88D;"> -it</span><span style="color:#C3E88D;"> zhangling-mysql</span><span style="color:#C3E88D;"> bash</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div></div><h2 id="连接数据库" tabindex="-1">连接数据库 <a class="header-anchor" href="#连接数据库" aria-label="Permalink to &quot;连接数据库&quot;">​</a></h2><div class="language-shell line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">shell</span><pre class="shiki material-theme-palenight vp-code" tabindex="0"><code><span class="line"><span style="color:#FFCB6B;">mysql</span><span style="color:#C3E88D;"> -uroot</span><span style="color:#C3E88D;"> -pZhangling@</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br></div></div><div class="warning custom-block"><p class="custom-block-title">若出现下面问题</p><p>Access denied for user &#39;root&#39;@&#39;localhost&#39;</p><p>需要开启mysql安全模式</p><p>docker cp zhangling-mysql:/etc/my.cnf /zhangling/my.cnf</p><div class="language-shell line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">shell</span><pre class="shiki material-theme-palenight vp-code" tabindex="0"><code><span class="line"><span style="color:#676E95;font-style:italic;"># For advice on how to change settings please see</span></span>
<span class="line"><span style="color:#676E95;font-style:italic;"># http://dev.mysql.com/doc/refman/8.1/en/server-configuration-defaults.html</span></span>
<span class="line"></span>
<span class="line"><span style="color:#89DDFF;">[</span><span style="color:#BABED8;">mysqld</span><span style="color:#89DDFF;">]</span></span>
<span class="line"><span style="color:#676E95;font-style:italic;">#</span></span>
<span class="line"><span style="color:#676E95;font-style:italic;"># Remove leading # and set to the amount of RAM for the most important data</span></span>
<span class="line"><span style="color:#82AAFF;">...</span></span>
<span class="line"><span style="color:#676E95;font-style:italic;"># read_rnd_buffer_size = 2M</span></span>
<span class="line"></span>
<span class="line"><span style="color:#82AAFF;">...</span></span>
<span class="line"><span style="color:#676E95;font-style:italic;"># default-authentication-plugin=mysql_native_password</span></span>
<span class="line"><span style="color:#FFCB6B;">skip-grant-tables</span><span style="color:#676E95;font-style:italic;"> #修改点</span></span>
<span class="line"><span style="color:#FFCB6B;">skip-host-cache</span></span>
<span class="line"><span style="color:#FFCB6B;">skip-name-resolve</span></span>
<span class="line"><span style="color:#82AAFF;">...</span></span>
<span class="line"></span>
<span class="line"><span style="color:#89DDFF;">!</span><span style="color:#FFCB6B;">includedir</span><span style="color:#C3E88D;"> /etc/mysql/conf.d/</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br></div></div><p>docker cp /zhangling/my.cnf zhangling-mysql:/etc/my.cnf</p><p>docker restart zhangling-mysql</p><p>docker exec -it zhangling-mysql bash</p><p>mysql -uroot -pxxxx[密码随你写]</p><p>select Host,User,authentication_string,plugin,ssl_type from user;</p><pre><code>| Host | User | Select_priv | Insert_priv | Update_priv | Delete_priv | Create_priv | Drop_priv | Reload_priv
| Shutdown_priv | Process_priv | File_priv | Grant_priv | References_priv | Index_priv | Alter_priv | Show_db_priv
| Super_priv | Create_tmp_table_priv | Lock_tables_priv | Execute_priv | Repl_slave_priv | Repl_client_priv
| Create_view_priv | Show_view_priv | Create_routine_priv | Alter_routine_priv | Create_user_priv | Event_priv
| Trigger_priv | Create_tablespace_priv | ssl_type | ssl_cipher | x509_issuer | x509_subject | max_questions
| max_updates | max_connections | max_user_connections | plugin | authentication_string | password_expired
| password_last_changed | password_lifetime | account_locked | Create_role_priv | Drop_role_priv | Password_reuse_history
| Password_reuse_time | Password_require_current | User_attributes |
</code></pre><p>UPDATE user SET <code>plugin</code>=&#39;mysgl_native_password&#39; WHERE user=&#39;root&#39;;</p><p>flush privileges;</p><p>ALTER USER &#39;root&#39;@&#39;localhost&#39; IDENTIFIED WITH mysql_native_password BY &#39;Zhangling@&#39;;</p><p>ALTER USER &#39;root&#39;@&#39;%&#39; IDENTIFIED WITH mysql_native_password BY &#39;Zhangling@&#39;;</p><p>flush privileges;</p></div><h2 id="赋予权限" tabindex="-1">赋予权限 <a class="header-anchor" href="#赋予权限" aria-label="Permalink to &quot;赋予权限&quot;">​</a></h2><div class="language- line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki material-theme-palenight vp-code" tabindex="0"><code><span class="line"><span>GRANT ALL PRIVILEGES ON *.* TO &#39;user&#39;@&#39;%&#39; IDENTIFIED BY &#39;password&#39;</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br></div></div><h2 id="开启ssl" tabindex="-1">开启SSL <a class="header-anchor" href="#开启ssl" aria-label="Permalink to &quot;开启SSL&quot;">​</a></h2><h3 id="生成证书" tabindex="-1">1️⃣生成证书 <a class="header-anchor" href="#生成证书" aria-label="Permalink to &quot;:one:生成证书&quot;">​</a></h3><div class="language-bash line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki material-theme-palenight vp-code" tabindex="0"><code><span class="line"><span style="color:#FFCB6B;">openssl</span><span style="color:#C3E88D;"> genrsa</span><span style="color:#F78C6C;"> 2048</span><span style="color:#89DDFF;"> &gt;</span><span style="color:#C3E88D;"> ca-key.pem</span></span>
<span class="line"></span>
<span class="line"><span style="color:#FFCB6B;">openssl</span><span style="color:#C3E88D;"> req</span><span style="color:#C3E88D;"> -new</span><span style="color:#C3E88D;"> -x509</span><span style="color:#C3E88D;"> -nodes</span><span style="color:#C3E88D;"> -days</span><span style="color:#F78C6C;"> 365000</span><span style="color:#C3E88D;"> -key</span><span style="color:#C3E88D;"> ca-key.pem</span><span style="color:#C3E88D;"> -out</span><span style="color:#C3E88D;"> ca-cert.pem</span></span>
<span class="line"></span>
<span class="line"><span style="color:#FFCB6B;">openssl</span><span style="color:#C3E88D;"> req</span><span style="color:#C3E88D;"> -newkey</span><span style="color:#C3E88D;"> rsa:2048</span><span style="color:#C3E88D;"> -days</span><span style="color:#F78C6C;"> 3650</span><span style="color:#C3E88D;"> -nodes</span><span style="color:#C3E88D;"> -keyout</span><span style="color:#C3E88D;"> server-key.pem</span><span style="color:#C3E88D;"> -out</span><span style="color:#C3E88D;"> server-req.pem</span></span>
<span class="line"></span>
<span class="line"><span style="color:#FFCB6B;">openssl</span><span style="color:#C3E88D;"> rsa</span><span style="color:#C3E88D;"> -in</span><span style="color:#C3E88D;"> server-key.pem</span><span style="color:#C3E88D;"> -out</span><span style="color:#C3E88D;"> server-key.pem</span></span>
<span class="line"></span>
<span class="line"><span style="color:#FFCB6B;">openssl</span><span style="color:#C3E88D;"> x509</span><span style="color:#C3E88D;"> -req</span><span style="color:#C3E88D;"> -in</span><span style="color:#C3E88D;"> server-req.pem</span><span style="color:#C3E88D;"> -days</span><span style="color:#F78C6C;"> 3650</span><span style="color:#C3E88D;"> -CA</span><span style="color:#C3E88D;"> ca-cert.pem</span><span style="color:#C3E88D;"> -CAkey</span><span style="color:#C3E88D;"> ca-key.pem</span><span style="color:#C3E88D;"> -set_serial</span><span style="color:#F78C6C;"> 01</span><span style="color:#C3E88D;"> -out</span><span style="color:#C3E88D;"> server-cert.pem</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br></div></div><h3 id="修改配置" tabindex="-1">2️⃣修改配置 <a class="header-anchor" href="#修改配置" aria-label="Permalink to &quot;:two:修改配置&quot;">​</a></h3><p>/etc/my.cnf</p><div class="language-bash line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki material-theme-palenight vp-code" tabindex="0"><code><span class="line"><span style="color:#89DDFF;">[</span><span style="color:#BABED8;">mysqld</span><span style="color:#89DDFF;">]</span></span>
<span class="line"><span style="color:#82AAFF;">...</span></span>
<span class="line"><span style="color:#FFCB6B;">ssl</span></span>
<span class="line"><span style="color:#BABED8;">ssl-ca</span><span style="color:#89DDFF;">=</span><span style="color:#C3E88D;">/path/to/ca-cert.pem</span></span>
<span class="line"><span style="color:#BABED8;">ssl-cert</span><span style="color:#89DDFF;">=</span><span style="color:#C3E88D;">/path/to/server-cert.pem</span></span>
<span class="line"><span style="color:#BABED8;">ssl-key</span><span style="color:#89DDFF;">=</span><span style="color:#C3E88D;">/path/to/server-key.pem</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br></div></div><h3 id="查看是否成功" tabindex="-1">3️⃣查看是否成功 <a class="header-anchor" href="#查看是否成功" aria-label="Permalink to &quot;:three:查看是否成功&quot;">​</a></h3><div class="language-bash line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki material-theme-palenight vp-code" tabindex="0"><code><span class="line"><span style="color:#FFCB6B;">mysql</span><span style="color:#C3E88D;"> -u</span><span style="color:#C3E88D;"> root</span><span style="color:#C3E88D;"> -pSyhbj@123</span><span style="color:#C3E88D;"> --ssl-ca=/root/mysql-server.crt</span><span style="color:#C3E88D;"> --ssl-cert=/root/mysql-server.crt</span><span style="color:#C3E88D;"> --ssl-key=/root/mysql-server.key</span></span>
<span class="line"><span style="color:#FFCB6B;">mysql</span><span style="color:#C3E88D;"> -uroot</span><span style="color:#C3E88D;"> -pSyhbj@123</span></span>
<span class="line"><span style="color:#FFCB6B;">show</span><span style="color:#C3E88D;"> variables</span><span style="color:#C3E88D;"> like</span><span style="color:#89DDFF;"> &#39;</span><span style="color:#C3E88D;">datadir</span><span style="color:#89DDFF;">&#39;</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#FFCB6B;">show</span><span style="color:#C3E88D;"> variables</span><span style="color:#C3E88D;"> like</span><span style="color:#89DDFF;"> &#39;</span><span style="color:#C3E88D;">%ssl%</span><span style="color:#89DDFF;">&#39;</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#FFCB6B;">show</span><span style="color:#C3E88D;"> variables</span><span style="color:#C3E88D;"> like</span><span style="color:#89DDFF;"> &#39;</span><span style="color:#C3E88D;">have_ssl</span><span style="color:#89DDFF;">&#39;</span><span style="color:#89DDFF;">;</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br></div></div><h3 id="创建ssl访问的用户" tabindex="-1">4️⃣ 创建SSL访问的用户 <a class="header-anchor" href="#创建ssl访问的用户" aria-label="Permalink to &quot;:four: 创建SSL访问的用户&quot;">​</a></h3><div class="language- line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki material-theme-palenight vp-code" tabindex="0"><code><span class="line"><span>GRANT ALL PRIVILEGES ON *.* TO &#39;xuser&#39;@&#39;%&#39; IDENTIFIED BY &#39;xpassword&#39; REQUIRE SSL;</span></span>
<span class="line"><span>FLUSH PRIVILEGES;</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div>`,18),r=[p];function o(t,c,i,y,d,b){return n(),a("div",null,r)}const h=s(l,[["render",o]]);export{u as __pageData,h as default};
