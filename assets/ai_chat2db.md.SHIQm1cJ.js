import{_ as s,c as a,o as n,a4 as e}from"./chunks/framework.CCJHkvW2.js";const b=JSON.parse('{"title":"chat2DB","description":"","frontmatter":{},"headers":[],"relativePath":"ai/chat2db.md","filePath":"ai/chat2db.md","lastUpdated":1714021425000}'),p={name:"ai/chat2db.md"},l=e(`<h1 id="chat2db" tabindex="-1">chat2DB <a class="header-anchor" href="#chat2db" aria-label="Permalink to &quot;chat2DB&quot;">​</a></h1><p>github地址(<a href="https://github.com/chat2db/Chat2DB" target="_blank" rel="noreferrer">https://github.com/chat2db/Chat2DB</a>)</p><p>文档地址(<a href="https://docs.chat2db.ai/docs/start-guide/getting-started" target="_blank" rel="noreferrer">https://docs.chat2db.ai/docs/start-guide/getting-started</a>)</p><div class="language-shell line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">shell</span><pre class="shiki material-theme-palenight vp-code" tabindex="0"><code><span class="line"><span style="color:#FFCB6B;">docker</span><span style="color:#C3E88D;"> run</span><span style="color:#C3E88D;"> -d</span><span style="color:#C3E88D;"> --name=chat2db</span><span style="color:#C3E88D;"> -p</span><span style="color:#C3E88D;"> 10824:10824</span><span style="color:#C3E88D;"> -v</span><span style="color:#C3E88D;"> /docker/chat2db:/root/.chat2db</span><span style="color:#C3E88D;">  chat2db/chat2db:latest</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br></div></div><p>github中的docker-start.sh文件(<a href="https://github.com/chat2db/Chat2DB/blob/main/docker/docker-start.sh" target="_blank" rel="noreferrer">https://github.com/chat2db/Chat2DB/blob/main/docker/docker-start.sh</a>)</p><p>webui地址</p><div class="language-http line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">http</span><pre class="shiki material-theme-palenight vp-code" tabindex="0"><code><span class="line"><span style="color:#BABED8;">http://172.26.25.35:10824/</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br></div></div><p>账号 chat2db 密码 chat2db</p><h2 id="本地推理-通过python代码调用" tabindex="-1">本地推理(通过python代码调用) <a class="header-anchor" href="#本地推理-通过python代码调用" aria-label="Permalink to &quot;本地推理(通过python代码调用)&quot;">​</a></h2><p>下载模型文件</p><p>hugface(<a href="https://huggingface.co/Chat2DB/Chat2DB-SQL-7B" target="_blank" rel="noreferrer">https://huggingface.co/Chat2DB/Chat2DB-SQL-7B</a>)</p><p>魔塔(<a href="https://modelscope.cn/models/Chat2DB/Chat2DB-SQL-7B/summary" target="_blank" rel="noreferrer">https://modelscope.cn/models/Chat2DB/Chat2DB-SQL-7B/summary</a>)</p><p>安装windows pytorch CUP版本</p><div class="language-shell line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">shell</span><pre class="shiki material-theme-palenight vp-code" tabindex="0"><code><span class="line"><span style="color:#FFCB6B;">conda</span><span style="color:#C3E88D;"> install</span><span style="color:#C3E88D;"> pytorch</span><span style="color:#C3E88D;"> torchvision</span><span style="color:#C3E88D;"> torchaudio</span><span style="color:#C3E88D;"> cpuonly</span><span style="color:#C3E88D;"> -c</span><span style="color:#C3E88D;"> pytorch</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br></div></div><p>安装transformers</p><div class="language-shell line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">shell</span><pre class="shiki material-theme-palenight vp-code" tabindex="0"><code><span class="line"><span style="color:#FFCB6B;">pip</span><span style="color:#C3E88D;"> install</span><span style="color:#C3E88D;"> transformers</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br></div></div><p>或</p><div class="language-shell line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">shell</span><pre class="shiki material-theme-palenight vp-code" tabindex="0"><code><span class="line"><span style="color:#FFCB6B;">conda</span><span style="color:#C3E88D;"> install</span><span style="color:#C3E88D;"> transformers</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br></div></div><p>安装fastapi启动器</p><div class="language-shell line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">shell</span><pre class="shiki material-theme-palenight vp-code" tabindex="0"><code><span class="line"><span style="color:#FFCB6B;">pip</span><span style="color:#C3E88D;"> install</span><span style="color:#C3E88D;"> uvicorn</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br></div></div><p>报错</p><div class="language-text line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">text</span><pre class="shiki material-theme-palenight vp-code" tabindex="0"><code><span class="line"><span>D:\\AI\\PycharmProjects\\fastApiProject\\chat2db.py:5: SyntaxWarning: invalid escape sequence &#39;\\A&#39;</span></span>
<span class="line"><span>  model_path = &quot;D:\\AI\\models\\chat2db\\Chat2DB-SQL-7B&quot; # This can be replaced with your local model path</span></span>
<span class="line"><span>  </span></span>
<span class="line"><span>Traceback (most recent call last):</span></span>
<span class="line"><span></span></span>
<span class="line"><span>  File &quot;D:\\Program Files\\JetBrains\\PyCharm 2024.1\\plugins\\python\\helpers\\pydev\\pydevd.py&quot;, line 1535, in _exec</span></span>
<span class="line"><span>    pydev_imports.execfile(file, globals, locals)  # execute the script</span></span>
<span class="line"><span>    ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^</span></span>
<span class="line"><span>    </span></span>
<span class="line"><span>  File &quot;D:\\Program Files\\JetBrains\\PyCharm 2024.1\\plugins\\python\\helpers\\pydev\\_pydev_imps\\_pydev_execfile.py&quot;, line 18, in execfile</span></span>
<span class="line"><span>    exec(compile(contents+&quot;\\n&quot;, file, &#39;exec&#39;), glob, loc)</span></span>
<span class="line"><span>    </span></span>
<span class="line"><span>  File &quot;D:\\AI\\PycharmProjects\\fastApiProject\\chat2db.py&quot;, line 14, in &lt;module&gt;</span></span>
<span class="line"><span>    test()</span></span>
<span class="line"><span>  File &quot;D:\\AI\\PycharmProjects\\fastApiProject\\chat2db.py&quot;, line 6, in test</span></span>
<span class="line"><span>    tokenizer = AutoTokenizer.from_pretrained(model_path, trust_remote_code=True,legacy=False,use_fast=False)</span></span>
<span class="line"><span>                ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^</span></span>
<span class="line"><span>  File &quot;D:\\ProgramData\\anaconda3\\envs\\chat2db\\Lib\\site-packages\\transformers\\models\\auto\\tokenization_auto.py&quot;, line 837, in from_pretrained</span></span>
<span class="line"><span>    return tokenizer_class.from_pretrained(pretrained_model_name_or_path, *inputs, **kwargs)</span></span>
<span class="line"><span>           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^</span></span>
<span class="line"><span>  File &quot;D:\\ProgramData\\anaconda3\\envs\\chat2db\\Lib\\site-packages\\transformers\\utils\\import_utils.py&quot;, line 1412, in __getattribute__</span></span>
<span class="line"><span>    requires_backends(cls, cls._backends)</span></span>
<span class="line"><span>  File &quot;D:\\ProgramData\\anaconda3\\envs\\chat2db\\Lib\\site-packages\\transformers\\utils\\import_utils.py&quot;, line 1400, in requires_backends</span></span>
<span class="line"><span>    raise ImportError(&quot;&quot;.join(failed))</span></span>
<span class="line"><span>ImportError: </span></span>
<span class="line"><span>LlamaTokenizer requires the SentencePiece library but it was not found in your environment. Checkout the instructions on the</span></span>
<span class="line"><span>installation page of its repo: https://github.com/google/sentencepiece#installation and follow the ones</span></span>
<span class="line"><span>that match your environment. Please note that you may need to restart your runtime after installation.</span></span>
<span class="line"><span></span></span>
<span class="line"><span>python-BaseException</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br></div></div><p>安装</p><div class="language-shell line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">shell</span><pre class="shiki material-theme-palenight vp-code" tabindex="0"><code><span class="line"><span style="color:#FFCB6B;">pip</span><span style="color:#C3E88D;"> install</span><span style="color:#C3E88D;"> sentencepiece</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br></div></div><p>或</p><div class="language-shell line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">shell</span><pre class="shiki material-theme-palenight vp-code" tabindex="0"><code><span class="line"><span style="color:#FFCB6B;">conda</span><span style="color:#C3E88D;"> install</span><span style="color:#C3E88D;"> sentencepiece</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br></div></div><p>报错</p><div class="language-text line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">text</span><pre class="shiki material-theme-palenight vp-code" tabindex="0"><code><span class="line"><span>D:\\ProgramData\\anaconda3\\envs\\chat2db\\python.exe -X pycache_prefix=C:\\Users\\Administrator\\AppData\\Local\\JetBrains\\PyCharm2024.1\\cpython-cache &quot;D:/Program Files/JetBrains/PyCharm 2024.1/plugins/python/helpers/pydev/pydevd.py&quot; --multiprocess --qt-support=auto --client 127.0.0.1 --port 62227 --file D:\\AI\\PycharmProjects\\fastApiProject\\chat2db.py </span></span>
<span class="line"><span>Connected to pydev debugger (build 241.14494.241)</span></span>
<span class="line"><span>D:\\AI\\PycharmProjects\\fastApiProject\\chat2db.py:5: SyntaxWarning: invalid escape sequence &#39;\\A&#39;</span></span>
<span class="line"><span>  model_path = &quot;D:\\AI\\models\\chat2db\\Chat2DB-SQL-7B&quot; # This can be replaced with your local model path</span></span>
<span class="line"><span>Traceback (most recent call last):</span></span>
<span class="line"><span>  File &quot;D:\\Program Files\\JetBrains\\PyCharm 2024.1\\plugins\\python\\helpers\\pydev\\pydevd.py&quot;, line 1535, in _exec</span></span>
<span class="line"><span>    pydev_imports.execfile(file, globals, locals)  # execute the script</span></span>
<span class="line"><span>    ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^</span></span>
<span class="line"><span>  File &quot;D:\\Program Files\\JetBrains\\PyCharm 2024.1\\plugins\\python\\helpers\\pydev\\_pydev_imps\\_pydev_execfile.py&quot;, line 18, in execfile</span></span>
<span class="line"><span>    exec(compile(contents+&quot;\\n&quot;, file, &#39;exec&#39;), glob, loc)</span></span>
<span class="line"><span>  File &quot;D:\\AI\\PycharmProjects\\fastApiProject\\chat2db.py&quot;, line 14, in &lt;module&gt;</span></span>
<span class="line"><span>    test()</span></span>
<span class="line"><span>  File &quot;D:\\AI\\PycharmProjects\\fastApiProject\\chat2db.py&quot;, line 6, in test</span></span>
<span class="line"><span>    tokenizer = AutoTokenizer.from_pretrained(model_path, trust_remote_code=True,legacy=False,use_fast=False)</span></span>
<span class="line"><span>                ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^</span></span>
<span class="line"><span>  File &quot;D:\\ProgramData\\anaconda3\\envs\\chat2db\\Lib\\site-packages\\transformers\\models\\auto\\tokenization_auto.py&quot;, line 837, in from_pretrained</span></span>
<span class="line"><span>    return tokenizer_class.from_pretrained(pretrained_model_name_or_path, *inputs, **kwargs)</span></span>
<span class="line"><span>           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^</span></span>
<span class="line"><span>  File &quot;D:\\ProgramData\\anaconda3\\envs\\chat2db\\Lib\\site-packages\\transformers\\tokenization_utils_base.py&quot;, line 2086, in from_pretrained</span></span>
<span class="line"><span>    return cls._from_pretrained(</span></span>
<span class="line"><span>           ^^^^^^^^^^^^^^^^^^^^^</span></span>
<span class="line"><span>  File &quot;D:\\ProgramData\\anaconda3\\envs\\chat2db\\Lib\\site-packages\\transformers\\tokenization_utils_base.py&quot;, line 2325, in _from_pretrained</span></span>
<span class="line"><span>    tokenizer = cls(*init_inputs, **init_kwargs)</span></span>
<span class="line"><span>                ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^</span></span>
<span class="line"><span>  File &quot;D:\\ProgramData\\anaconda3\\envs\\chat2db\\Lib\\site-packages\\transformers\\models\\llama\\tokenization_llama.py&quot;, line 182, in __init__</span></span>
<span class="line"><span>    self.sp_model = self.get_spm_processor(kwargs.pop(&quot;from_slow&quot;, False))</span></span>
<span class="line"><span>                    ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^</span></span>
<span class="line"><span>  File &quot;D:\\ProgramData\\anaconda3\\envs\\chat2db\\Lib\\site-packages\\transformers\\models\\llama\\tokenization_llama.py&quot;, line 214, in get_spm_processor</span></span>
<span class="line"><span>    model_pb2 = import_protobuf(f&quot;The new behaviour of {self.__class__.__name__} (with \`self.legacy = False\`)&quot;)</span></span>
<span class="line"><span>                ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^</span></span>
<span class="line"><span>  File &quot;D:\\ProgramData\\anaconda3\\envs\\chat2db\\Lib\\site-packages\\transformers\\convert_slow_tokenizer.py&quot;, line 43, in import_protobuf</span></span>
<span class="line"><span>    raise ImportError(PROTOBUF_IMPORT_ERROR.format(error_message))</span></span>
<span class="line"><span>ImportError: </span></span>
<span class="line"><span>The new behaviour of LlamaTokenizer (with \`self.legacy = False\`) requires the protobuf library but it was not found in your environment. Checkout the instructions on the</span></span>
<span class="line"><span>installation page of its repo: https://github.com/protocolbuffers/protobuf/tree/master/python#installation and follow the ones</span></span>
<span class="line"><span>that match your environment. Please note that you may need to restart your runtime after installation.</span></span>
<span class="line"><span></span></span>
<span class="line"><span>python-BaseException</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br></div></div><p>安装</p><div class="language-shell line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">shell</span><pre class="shiki material-theme-palenight vp-code" tabindex="0"><code><span class="line"><span style="color:#FFCB6B;">pip</span><span style="color:#C3E88D;"> install</span><span style="color:#C3E88D;"> protobuf</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br></div></div><p>或</p><div class="language-shell line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">shell</span><pre class="shiki material-theme-palenight vp-code" tabindex="0"><code><span class="line"><span style="color:#FFCB6B;">conda</span><span style="color:#C3E88D;">  install</span><span style="color:#C3E88D;"> protobuf</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br></div></div><p>报错</p><div class="language-text line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">text</span><pre class="shiki material-theme-palenight vp-code" tabindex="0"><code><span class="line"><span>D:\\ProgramData\\anaconda3\\envs\\chat2db\\python.exe -X pycache_prefix=C:\\Users\\Administrator\\AppData\\Local\\JetBrains\\PyCharm2024.1\\cpython-cache &quot;D:/Program Files/JetBrains/PyCharm 2024.1/plugins/python/helpers/pydev/pydevd.py&quot; --multiprocess --qt-support=auto --client 127.0.0.1 --port 62298 --file D:\\AI\\PycharmProjects\\fastApiProject\\chat2db.py </span></span>
<span class="line"><span>Connected to pydev debugger (build 241.14494.241)</span></span>
<span class="line"><span>D:\\AI\\PycharmProjects\\fastApiProject\\chat2db.py:5: SyntaxWarning: invalid escape sequence &#39;\\A&#39;</span></span>
<span class="line"><span>  model_path = &quot;D:\\AI\\models\\chat2db\\Chat2DB-SQL-7B&quot; # This can be replaced with your local model path</span></span>
<span class="line"><span>Traceback (most recent call last):</span></span>
<span class="line"><span>  File &quot;D:\\Program Files\\JetBrains\\PyCharm 2024.1\\plugins\\python\\helpers\\pydev\\pydevd.py&quot;, line 1535, in _exec</span></span>
<span class="line"><span>    pydev_imports.execfile(file, globals, locals)  # execute the script</span></span>
<span class="line"><span>    ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^</span></span>
<span class="line"><span>  File &quot;D:\\Program Files\\JetBrains\\PyCharm 2024.1\\plugins\\python\\helpers\\pydev\\_pydev_imps\\_pydev_execfile.py&quot;, line 18, in execfile</span></span>
<span class="line"><span>    exec(compile(contents+&quot;\\n&quot;, file, &#39;exec&#39;), glob, loc)</span></span>
<span class="line"><span>  File &quot;D:\\AI\\PycharmProjects\\fastApiProject\\chat2db.py&quot;, line 14, in &lt;module&gt;</span></span>
<span class="line"><span>    test()</span></span>
<span class="line"><span>  File &quot;D:\\AI\\PycharmProjects\\fastApiProject\\chat2db.py&quot;, line 7, in test</span></span>
<span class="line"><span>    model = AutoModelForCausalLM.from_pretrained(model_path, device_map=&quot;cpu&quot;, trust_remote_code=True, torch_dtype=torch.float16, use_cache=True)</span></span>
<span class="line"><span>            ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^</span></span>
<span class="line"><span>  File &quot;D:\\ProgramData\\anaconda3\\envs\\chat2db\\Lib\\site-packages\\transformers\\models\\auto\\auto_factory.py&quot;, line 563, in from_pretrained</span></span>
<span class="line"><span>    return model_class.from_pretrained(</span></span>
<span class="line"><span>           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^</span></span>
<span class="line"><span>  File &quot;D:\\ProgramData\\anaconda3\\envs\\chat2db\\Lib\\site-packages\\transformers\\modeling_utils.py&quot;, line 2970, in from_pretrained</span></span>
<span class="line"><span>    raise ImportError(</span></span>
<span class="line"><span>ImportError: Using \`low_cpu_mem_usage=True\` or a \`device_map\` requires Accelerate: \`pip install accelerate\`</span></span>
<span class="line"><span>python-BaseException</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br></div></div><div class="language-shell line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">shell</span><pre class="shiki material-theme-palenight vp-code" tabindex="0"><code><span class="line"><span style="color:#FFCB6B;">pip</span><span style="color:#C3E88D;"> install</span><span style="color:#C3E88D;"> accelerate</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br></div></div><p>或</p><div class="language-shell line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">shell</span><pre class="shiki material-theme-palenight vp-code" tabindex="0"><code><span class="line"><span style="color:#FFCB6B;">conda</span><span style="color:#C3E88D;"> install</span><span style="color:#C3E88D;"> accelerate</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br></div></div><p>代码</p><div class="language-python line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">python</span><pre class="shiki material-theme-palenight vp-code" tabindex="0"><code><span class="line"><span style="color:#C792EA;">def</span><span style="color:#82AAFF;"> test</span><span style="color:#89DDFF;">():</span></span>
<span class="line"><span style="color:#BABED8;">    model_path </span><span style="color:#89DDFF;">=</span><span style="color:#89DDFF;"> &quot;</span><span style="color:#C3E88D;">Chat2DB-SQL-7B</span><span style="color:#89DDFF;">&quot;</span><span style="color:#676E95;font-style:italic;"> # This can be replaced with your local model path</span></span>
<span class="line"><span style="color:#BABED8;">    tokenizer </span><span style="color:#89DDFF;">=</span><span style="color:#BABED8;"> AutoTokenizer</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">from_pretrained</span><span style="color:#89DDFF;">(</span><span style="color:#82AAFF;">model_path</span><span style="color:#89DDFF;">,</span><span style="color:#BABED8;font-style:italic;"> trust_remote_code</span><span style="color:#89DDFF;">=True,</span><span style="color:#BABED8;font-style:italic;">legacy</span><span style="color:#89DDFF;">=False,</span><span style="color:#BABED8;font-style:italic;">use_fast</span><span style="color:#89DDFF;">=False)</span></span>
<span class="line"><span style="color:#BABED8;">    model </span><span style="color:#89DDFF;">=</span><span style="color:#BABED8;"> AutoModelForCausalLM</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">from_pretrained</span><span style="color:#89DDFF;">(</span><span style="color:#82AAFF;">model_path</span><span style="color:#89DDFF;">,</span><span style="color:#BABED8;font-style:italic;"> device_map</span><span style="color:#89DDFF;">=</span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">cpu</span><span style="color:#89DDFF;">&quot;</span><span style="color:#89DDFF;">,</span><span style="color:#BABED8;font-style:italic;"> trust_remote_code</span><span style="color:#89DDFF;">=True,</span><span style="color:#BABED8;font-style:italic;"> torch_dtype</span><span style="color:#89DDFF;">=</span><span style="color:#82AAFF;">torch</span><span style="color:#89DDFF;">.</span><span style="color:#F07178;">float16</span><span style="color:#89DDFF;">,</span><span style="color:#BABED8;font-style:italic;"> use_cache</span><span style="color:#89DDFF;">=True)</span></span>
<span class="line"><span style="color:#BABED8;">    pipe </span><span style="color:#89DDFF;">=</span><span style="color:#82AAFF;"> pipeline</span><span style="color:#89DDFF;">(</span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">text-generation</span><span style="color:#89DDFF;">&quot;</span><span style="color:#89DDFF;">,</span><span style="color:#BABED8;font-style:italic;"> model</span><span style="color:#89DDFF;">=</span><span style="color:#82AAFF;">model</span><span style="color:#89DDFF;">,</span><span style="color:#BABED8;font-style:italic;"> tokenizer</span><span style="color:#89DDFF;">=</span><span style="color:#82AAFF;">tokenizer</span><span style="color:#89DDFF;">,</span><span style="color:#BABED8;font-style:italic;"> return_full_text</span><span style="color:#89DDFF;">=False,</span><span style="color:#BABED8;font-style:italic;"> max_new_tokens</span><span style="color:#89DDFF;">=</span><span style="color:#F78C6C;">100</span><span style="color:#89DDFF;">)</span></span>
<span class="line"><span style="color:#BABED8;">    prompt </span><span style="color:#89DDFF;">=</span><span style="color:#89DDFF;"> &quot;</span><span style="color:#C3E88D;">### Database Schema</span><span style="color:#BABED8;">\\n\\n</span><span style="color:#C3E88D;">[&#39;CREATE TABLE </span><span style="color:#BABED8;">\\&quot;</span><span style="color:#C3E88D;">stadium</span><span style="color:#BABED8;">\\&quot;</span><span style="color:#C3E88D;"> (</span><span style="color:#BABED8;">\\\\</span><span style="color:#C3E88D;">n</span><span style="color:#BABED8;">\\&quot;</span><span style="color:#C3E88D;">Stadium_ID</span><span style="color:#BABED8;">\\&quot;</span><span style="color:#C3E88D;"> int,</span><span style="color:#BABED8;">\\\\</span><span style="color:#C3E88D;">n</span><span style="color:#BABED8;">\\&quot;</span><span style="color:#C3E88D;">Location</span><span style="color:#BABED8;">\\&quot;</span><span style="color:#C3E88D;"> text,</span><span style="color:#BABED8;">\\\\</span><span style="color:#C3E88D;">n</span><span style="color:#BABED8;">\\&quot;</span><span style="color:#C3E88D;">Name</span><span style="color:#BABED8;">\\&quot;</span><span style="color:#C3E88D;"> text,</span><span style="color:#BABED8;">\\\\</span><span style="color:#C3E88D;">n</span><span style="color:#BABED8;">\\&quot;</span><span style="color:#C3E88D;">Capacity</span><span style="color:#BABED8;">\\&quot;</span><span style="color:#C3E88D;"> int,</span><span style="color:#BABED8;">\\\\</span><span style="color:#C3E88D;">n</span><span style="color:#BABED8;">\\&quot;</span><span style="color:#C3E88D;">Highest</span><span style="color:#BABED8;">\\&quot;</span><span style="color:#C3E88D;"> int,</span><span style="color:#BABED8;">\\\\</span><span style="color:#C3E88D;">n</span><span style="color:#BABED8;">\\&quot;</span><span style="color:#C3E88D;">Lowest</span><span style="color:#BABED8;">\\&quot;</span><span style="color:#C3E88D;"> int,</span><span style="color:#BABED8;">\\\\</span><span style="color:#C3E88D;">n</span><span style="color:#BABED8;">\\&quot;</span><span style="color:#C3E88D;">Average</span><span style="color:#BABED8;">\\&quot;</span><span style="color:#C3E88D;"> int,</span><span style="color:#BABED8;">\\\\</span><span style="color:#C3E88D;">nPRIMARY KEY (</span><span style="color:#BABED8;">\\&quot;</span><span style="color:#C3E88D;">Stadium_ID</span><span style="color:#BABED8;">\\&quot;</span><span style="color:#C3E88D;">)</span><span style="color:#BABED8;">\\\\</span><span style="color:#C3E88D;">n);&#39;, &#39;CREATE TABLE </span><span style="color:#BABED8;">\\&quot;</span><span style="color:#C3E88D;">singer</span><span style="color:#BABED8;">\\&quot;</span><span style="color:#C3E88D;"> (</span><span style="color:#BABED8;">\\\\</span><span style="color:#C3E88D;">n</span><span style="color:#BABED8;">\\&quot;</span><span style="color:#C3E88D;">Singer_ID</span><span style="color:#BABED8;">\\&quot;</span><span style="color:#C3E88D;"> int,</span><span style="color:#BABED8;">\\\\</span><span style="color:#C3E88D;">n</span><span style="color:#BABED8;">\\&quot;</span><span style="color:#C3E88D;">Name</span><span style="color:#BABED8;">\\&quot;</span><span style="color:#C3E88D;"> text,</span><span style="color:#BABED8;">\\\\</span><span style="color:#C3E88D;">n</span><span style="color:#BABED8;">\\&quot;</span><span style="color:#C3E88D;">Country</span><span style="color:#BABED8;">\\&quot;</span><span style="color:#C3E88D;"> text,</span><span style="color:#BABED8;">\\\\</span><span style="color:#C3E88D;">n</span><span style="color:#BABED8;">\\&quot;</span><span style="color:#C3E88D;">Song_Name</span><span style="color:#BABED8;">\\&quot;</span><span style="color:#C3E88D;"> text,</span><span style="color:#BABED8;">\\\\</span><span style="color:#C3E88D;">n</span><span style="color:#BABED8;">\\&quot;</span><span style="color:#C3E88D;">Song_release_year</span><span style="color:#BABED8;">\\&quot;</span><span style="color:#C3E88D;"> text,</span><span style="color:#BABED8;">\\\\</span><span style="color:#C3E88D;">n</span><span style="color:#BABED8;">\\&quot;</span><span style="color:#C3E88D;">Age</span><span style="color:#BABED8;">\\&quot;</span><span style="color:#C3E88D;"> int,</span><span style="color:#BABED8;">\\\\</span><span style="color:#C3E88D;">n</span><span style="color:#BABED8;">\\&quot;</span><span style="color:#C3E88D;">Is_male</span><span style="color:#BABED8;">\\&quot;</span><span style="color:#C3E88D;"> bool,</span><span style="color:#BABED8;">\\\\</span><span style="color:#C3E88D;">nPRIMARY KEY (</span><span style="color:#BABED8;">\\&quot;</span><span style="color:#C3E88D;">Singer_ID</span><span style="color:#BABED8;">\\&quot;</span><span style="color:#C3E88D;">)</span><span style="color:#BABED8;">\\\\</span><span style="color:#C3E88D;">n);&#39;, &#39;CREATE TABLE </span><span style="color:#BABED8;">\\&quot;</span><span style="color:#C3E88D;">concert</span><span style="color:#BABED8;">\\&quot;</span><span style="color:#C3E88D;"> (</span><span style="color:#BABED8;">\\\\</span><span style="color:#C3E88D;">n</span><span style="color:#BABED8;">\\&quot;</span><span style="color:#C3E88D;">concert_ID</span><span style="color:#BABED8;">\\&quot;</span><span style="color:#C3E88D;"> int,</span><span style="color:#BABED8;">\\\\</span><span style="color:#C3E88D;">n</span><span style="color:#BABED8;">\\&quot;</span><span style="color:#C3E88D;">concert_Name</span><span style="color:#BABED8;">\\&quot;</span><span style="color:#C3E88D;"> text,</span><span style="color:#BABED8;">\\\\</span><span style="color:#C3E88D;">n</span><span style="color:#BABED8;">\\&quot;</span><span style="color:#C3E88D;">Theme</span><span style="color:#BABED8;">\\&quot;</span><span style="color:#C3E88D;"> text,</span><span style="color:#BABED8;">\\\\</span><span style="color:#C3E88D;">n</span><span style="color:#BABED8;">\\&quot;</span><span style="color:#C3E88D;">Stadium_ID</span><span style="color:#BABED8;">\\&quot;</span><span style="color:#C3E88D;"> text,</span><span style="color:#BABED8;">\\\\</span><span style="color:#C3E88D;">n</span><span style="color:#BABED8;">\\&quot;</span><span style="color:#C3E88D;">Year</span><span style="color:#BABED8;">\\&quot;</span><span style="color:#C3E88D;"> text,</span><span style="color:#BABED8;">\\\\</span><span style="color:#C3E88D;">nPRIMARY KEY (</span><span style="color:#BABED8;">\\&quot;</span><span style="color:#C3E88D;">concert_ID</span><span style="color:#BABED8;">\\&quot;</span><span style="color:#C3E88D;">),</span><span style="color:#BABED8;">\\\\</span><span style="color:#C3E88D;">nFOREIGN KEY (</span><span style="color:#BABED8;">\\&quot;</span><span style="color:#C3E88D;">Stadium_ID</span><span style="color:#BABED8;">\\&quot;</span><span style="color:#C3E88D;">) REFERENCES </span><span style="color:#BABED8;">\\&quot;</span><span style="color:#C3E88D;">stadium</span><span style="color:#BABED8;">\\&quot;</span><span style="color:#C3E88D;">(</span><span style="color:#BABED8;">\\&quot;</span><span style="color:#C3E88D;">Stadium_ID</span><span style="color:#BABED8;">\\&quot;</span><span style="color:#C3E88D;">)</span><span style="color:#BABED8;">\\\\</span><span style="color:#C3E88D;">n);&#39;, &#39;CREATE TABLE </span><span style="color:#BABED8;">\\&quot;</span><span style="color:#C3E88D;">singer_in_concert</span><span style="color:#BABED8;">\\&quot;</span><span style="color:#C3E88D;"> (</span><span style="color:#BABED8;">\\\\</span><span style="color:#C3E88D;">n</span><span style="color:#BABED8;">\\&quot;</span><span style="color:#C3E88D;">concert_ID</span><span style="color:#BABED8;">\\&quot;</span><span style="color:#C3E88D;"> int,</span><span style="color:#BABED8;">\\\\</span><span style="color:#C3E88D;">n</span><span style="color:#BABED8;">\\&quot;</span><span style="color:#C3E88D;">Singer_ID</span><span style="color:#BABED8;">\\&quot;</span><span style="color:#C3E88D;"> text,</span><span style="color:#BABED8;">\\\\</span><span style="color:#C3E88D;">nPRIMARY KEY (</span><span style="color:#BABED8;">\\&quot;</span><span style="color:#C3E88D;">concert_ID</span><span style="color:#BABED8;">\\&quot;</span><span style="color:#C3E88D;">,</span><span style="color:#BABED8;">\\&quot;</span><span style="color:#C3E88D;">Singer_ID</span><span style="color:#BABED8;">\\&quot;</span><span style="color:#C3E88D;">),</span><span style="color:#BABED8;">\\\\</span><span style="color:#C3E88D;">nFOREIGN KEY (</span><span style="color:#BABED8;">\\&quot;</span><span style="color:#C3E88D;">concert_ID</span><span style="color:#BABED8;">\\&quot;</span><span style="color:#C3E88D;">) REFERENCES </span><span style="color:#BABED8;">\\&quot;</span><span style="color:#C3E88D;">concert</span><span style="color:#BABED8;">\\&quot;</span><span style="color:#C3E88D;">(</span><span style="color:#BABED8;">\\&quot;</span><span style="color:#C3E88D;">concert_ID</span><span style="color:#BABED8;">\\&quot;</span><span style="color:#C3E88D;">),</span><span style="color:#BABED8;">\\\\</span><span style="color:#C3E88D;">nFOREIGN KEY (</span><span style="color:#BABED8;">\\&quot;</span><span style="color:#C3E88D;">Singer_ID</span><span style="color:#BABED8;">\\&quot;</span><span style="color:#C3E88D;">) REFERENCES </span><span style="color:#BABED8;">\\&quot;</span><span style="color:#C3E88D;">singer</span><span style="color:#BABED8;">\\&quot;</span><span style="color:#C3E88D;">(</span><span style="color:#BABED8;">\\&quot;</span><span style="color:#C3E88D;">Singer_ID</span><span style="color:#BABED8;">\\&quot;</span><span style="color:#C3E88D;">)</span><span style="color:#BABED8;">\\\\</span><span style="color:#C3E88D;">n);&#39;]</span><span style="color:#BABED8;">\\n\\n\\n</span><span style="color:#C3E88D;">### Task </span><span style="color:#BABED8;">\\n\\n</span><span style="color:#C3E88D;">Based on the provided database schema information, How many singers do we have?[SQL]</span><span style="color:#BABED8;">\\n</span><span style="color:#89DDFF;">&quot;</span></span>
<span class="line"><span style="color:#BABED8;">    response </span><span style="color:#89DDFF;">=</span><span style="color:#82AAFF;"> pipe</span><span style="color:#89DDFF;">(</span><span style="color:#82AAFF;">prompt</span><span style="color:#89DDFF;">)[</span><span style="color:#F78C6C;">0</span><span style="color:#89DDFF;">][</span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">generated_text</span><span style="color:#89DDFF;">&quot;</span><span style="color:#89DDFF;">]</span></span>
<span class="line"><span style="color:#82AAFF;">    print</span><span style="color:#89DDFF;">(</span><span style="color:#82AAFF;">response</span><span style="color:#89DDFF;">)</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br></div></div><h2 id="云端推理-chat2db的web服务调用在服务器部署的chat2db模型" tabindex="-1">云端推理(chat2db的web服务调用在服务器部署的chat2db模型) <a class="header-anchor" href="#云端推理-chat2db的web服务调用在服务器部署的chat2db模型" aria-label="Permalink to &quot;云端推理(chat2db的web服务调用在服务器部署的chat2db模型)&quot;">​</a></h2>`,40),o=[l];function t(r,c,i,y,u,D){return n(),a("div",null,o)}const m=s(p,[["render",t]]);export{b as __pageData,m as default};
