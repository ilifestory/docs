import{_ as s,c as a,o as n,a4 as l,bI as e,bJ as p}from"./chunks/framework.CCJHkvW2.js";const C=JSON.parse('{"title":"k8s包管理工具","description":"","frontmatter":{},"headers":[],"relativePath":"deployment/k8s/helm.md","filePath":"deployment/k8s/helm.md","lastUpdated":1710736177000}'),t={name:"deployment/k8s/helm.md"},r=l('<h1 id="k8s包管理工具" tabindex="-1">k8s包管理工具 <a class="header-anchor" href="#k8s包管理工具" aria-label="Permalink to &quot;k8s包管理工具&quot;">​</a></h1><h2 id="背景" tabindex="-1">背景 <a class="header-anchor" href="#背景" aria-label="Permalink to &quot;背景&quot;">​</a></h2><p>对于K8s来说，应用资源配置可以定义为K8s API对象，包括Deployment，Namespace，Service， PV（Persistent Volumes）和PVC（PersistentVolumeClaims）等等。通常一个应用的部署会涉及很多资源的共同协作，用户会定义这些API对象到一系列Yaml文件中，然后通过kubectl来逐一进行部署。</p><p>那么问题来了，假如我没接触过K8s, 只想部署个应用了解下，不会写Yaml一个个配这些资源对象怎么破？需要去结合K8s文档学习Yaml语法。过了几天我终于学会了，一个个配好了这些资源对象的Yaml文件，并逐一部署在这台机器上。后面想在这台机器上再重复部署几套，另外还有十台环境要配成和这台一样，怎么办？拷贝过去再一一部署出来？这配置管理也太麻烦了，不好用，直接劝退！</p><p>先别急！幸好已经有Helm，避免了我们去完成这些繁琐配置和维护过程。它能够把这些零零散散的应用资源文件放在一起进行统一配置，极大方便了开发人员对K8s集群应用的管理。</p><h2 id="架构图" tabindex="-1">架构图 <a class="header-anchor" href="#架构图" aria-label="Permalink to &quot;架构图&quot;">​</a></h2><p><img src="'+e+'" alt="An image"></p><p><img src="'+p+`" alt="An image"></p><p>Helm是官方提供类似于YUM的包管理，是部署环境的流程封装，Helm有三个重要的概念：chart、release和Repository</p><div class="tip custom-block"><p class="custom-block-title">说明</p><p><code>Helm</code>：Helm 是一个命令行下的客户端工具。主要用于 Kubernetes 应用程序 Chart 的创建、打包、发布以及创建和管理本地和远程的 Chart 仓库。</p><p><code>Tiller</code>：Tiller 是 Helm 的服务端，部署在 Kubernetes 集群中。Tiller 用于接收 Helm 的请求，并根据 Chart 生成 Kubernetes 的部署文件（ Helm 称为 Release ），然后提交给 Kubernetes 创建应用。Tiller 还提供了 Release 的升级、删除、回滚等一系列功能。</p><p><code>Chart</code>：Helm 的软件包，采用 TAR 格式。类似于 APT 的 DEB 包或者 YUM 的 RPM 包，其包含了一组定义 Kubernetes 资源相关的 YAML 文件。Chart有特定的文件目录结构，如果开发者想自定义一个新的 Chart，只需要使用Helm create命令生成一个目录结构即可进行开发。</p><p><code>Repoistory</code>：Helm 的软件仓库，Repository 本质上是一个 Web 服务器，该服务器保存了一系列的 Chart 软件包以供用户下载，并且提供了一个该 Repository 的 Chart 包的清单文件以供查询。Helm 可以同时管理多个不同的 Repository， 官方仓库的地址是<a href="https://hub.helm.sh" target="_blank" rel="noreferrer">https://hub.helm.sh</a>。</p><p><code>Release</code>：使用 helm install 命令在 Kubernetes 集群中部署的 Chart 称为 Release。</p></div><h2 id="常用指令" tabindex="-1">常用指令 <a class="header-anchor" href="#常用指令" aria-label="Permalink to &quot;常用指令&quot;">​</a></h2><p>查看仓库</p><div class="language-shell line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">shell</span><pre class="shiki material-theme-palenight vp-code" tabindex="0"><code><span class="line"><span style="color:#FFCB6B;">helm</span><span style="color:#C3E88D;"> repo</span><span style="color:#C3E88D;"> list</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br></div></div><p>添加仓库 helm repo add [name(key)] [仓库地址]</p><div class="language-shell line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">shell</span><pre class="shiki material-theme-palenight vp-code" tabindex="0"><code><span class="line"><span style="color:#FFCB6B;">helm</span><span style="color:#C3E88D;"> repo</span><span style="color:#C3E88D;"> add</span><span style="color:#C3E88D;"> zhangling</span><span style="color:#C3E88D;"> https://kubernetes.oss-cn-hangzhou.aliyuncs.com/charts</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br></div></div><p>添加私有仓库</p><div class="language-shell line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">shell</span><pre class="shiki material-theme-palenight vp-code" tabindex="0"><code><span class="line"><span style="color:#FFCB6B;">helm</span><span style="color:#C3E88D;"> repo</span><span style="color:#C3E88D;"> add</span><span style="color:#C3E88D;"> --username</span><span style="color:#C3E88D;"> zhangling</span><span style="color:#C3E88D;"> --password</span><span style="color:#C3E88D;"> xxxxxx</span><span style="color:#C3E88D;"> zhangling</span><span style="color:#C3E88D;"> http://172.26.25.7:8070/chartrepo/chart</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br></div></div><p>删除仓库</p><div class="language-shell line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">shell</span><pre class="shiki material-theme-palenight vp-code" tabindex="0"><code><span class="line"><span style="color:#FFCB6B;">helm</span><span style="color:#C3E88D;"> repo</span><span style="color:#C3E88D;"> remove</span><span style="color:#C3E88D;"> zhangling</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br></div></div><p>更新仓库</p><div class="language-shell line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">shell</span><pre class="shiki material-theme-palenight vp-code" tabindex="0"><code><span class="line"><span style="color:#FFCB6B;">helm</span><span style="color:#C3E88D;"> repo</span><span style="color:#C3E88D;"> update</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br></div></div><p>查看插件</p><div class="language-shell line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">shell</span><pre class="shiki material-theme-palenight vp-code" tabindex="0"><code><span class="line"><span style="color:#FFCB6B;">helm</span><span style="color:#C3E88D;"> plugin</span><span style="color:#C3E88D;"> list</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br></div></div><p>搜索 应用 helm search [mysql(应用名称)]</p><div class="language-shell line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">shell</span><pre class="shiki material-theme-palenight vp-code" tabindex="0"><code><span class="line"><span style="color:#FFCB6B;">helm</span><span style="color:#C3E88D;"> search</span><span style="color:#C3E88D;"> repo</span><span style="color:#C3E88D;"> mysql</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br></div></div><p>安装应用 helm install 仓库名称(name)/应用名称</p><div class="language-shell line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">shell</span><pre class="shiki material-theme-palenight vp-code" tabindex="0"><code><span class="line"><span style="color:#FFCB6B;">helm</span><span style="color:#C3E88D;"> install</span><span style="color:#C3E88D;"> zhangling/mysql</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br></div></div><p>如果并不想安装，只是想看下渲染的模板是什么样，可以使用--dry-run的参数</p><div class="language-shell line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">shell</span><pre class="shiki material-theme-palenight vp-code" tabindex="0"><code><span class="line"><span style="color:#FFCB6B;">helm</span><span style="color:#C3E88D;"> install</span><span style="color:#C3E88D;"> zhangling/mysql</span><span style="color:#C3E88D;"> --dry-run</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br></div></div><p>查看heml安装列表</p><div class="language-shell line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">shell</span><pre class="shiki material-theme-palenight vp-code" tabindex="0"><code><span class="line"><span style="color:#FFCB6B;">helm</span><span style="color:#C3E88D;"> list</span><span style="color:#C3E88D;"> -n</span><span style="color:#C3E88D;"> namespace</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br></div></div><p>卸载heml安装</p><div class="language-shell line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">shell</span><pre class="shiki material-theme-palenight vp-code" tabindex="0"><code><span class="line"><span style="color:#FFCB6B;">helm</span><span style="color:#C3E88D;"> uninstall</span><span style="color:#C3E88D;"> resourcename</span><span style="color:#C3E88D;"> -n</span><span style="color:#C3E88D;"> namespace</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br></div></div><p>创建自己的chart</p><div class="language-shell line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">shell</span><pre class="shiki material-theme-palenight vp-code" tabindex="0"><code><span class="line"><span style="color:#FFCB6B;">helm</span><span style="color:#C3E88D;"> create</span><span style="color:#C3E88D;"> zhangling-chart</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br></div></div><p>拉取公共chart helm pull 仓库名称(name)/应用名称 --version 14.1.1</p><div class="language-shell line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">shell</span><pre class="shiki material-theme-palenight vp-code" tabindex="0"><code><span class="line"><span style="color:#FFCB6B;">helm</span><span style="color:#C3E88D;"> pull</span><span style="color:#C3E88D;"> bitnami/nginx</span><span style="color:#C3E88D;"> --version</span><span style="color:#F78C6C;"> 14.1.1</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br></div></div><p>解压nginx Chart包</p><div class="language-shell line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">shell</span><pre class="shiki material-theme-palenight vp-code" tabindex="0"><code><span class="line"><span style="color:#FFCB6B;">tar</span><span style="color:#C3E88D;"> -zxf</span><span style="color:#C3E88D;"> nginx-14.1.1.tgz</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br></div></div><p>修改配置文件</p><div class="language-shell line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">shell</span><pre class="shiki material-theme-palenight vp-code" tabindex="0"><code><span class="line"><span style="color:#82AAFF;">cd</span><span style="color:#C3E88D;"> nginx/</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br></div></div><div class="language-shell line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">shell</span><pre class="shiki material-theme-palenight vp-code" tabindex="0"><code><span class="line"><span style="color:#FFCB6B;">vim</span><span style="color:#C3E88D;"> values.yaml</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br></div></div><div class="language-shell line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">shell</span><pre class="shiki material-theme-palenight vp-code" tabindex="0"><code><span class="line"><span style="color:#FFCB6B;">global:</span></span>
<span class="line"><span style="color:#FFCB6B;">    imageRegistry:</span><span style="color:#C3E88D;"> 192.168.65.30:88</span><span style="color:#676E95;font-style:italic;">    # 指定仓库地址</span></span>
<span class="line"><span style="color:#FFCB6B;">image:</span><span style="color:#676E95;font-style:italic;">                               # 指定镜像</span></span>
<span class="line"><span style="color:#FFCB6B;">    registry:</span><span style="color:#C3E88D;"> docker.io</span></span>
<span class="line"><span style="color:#FFCB6B;">    repository:</span><span style="color:#C3E88D;"> bitnami/nginx</span></span>
<span class="line"><span style="color:#FFCB6B;">    tag:</span><span style="color:#C3E88D;"> 1.19.7-debian-10-r1</span></span>
<span class="line"><span style="color:#FFCB6B;">    digest:</span><span style="color:#89DDFF;"> &quot;&quot;</span></span>
<span class="line"><span style="color:#FFCB6B;">service:</span></span>
<span class="line"><span style="color:#676E95;font-style:italic;">## @param service.type Service type</span></span>
<span class="line"><span style="color:#676E95;font-style:italic;">##</span></span>
<span class="line"><span style="color:#82AAFF;">    type</span><span style="color:#C3E88D;">:</span><span style="color:#C3E88D;"> ClusterIP</span><span style="color:#676E95;font-style:italic;">                   # 设置service类型</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br></div></div><p>测试nginx部署效果 安装zhangling-nginx</p><div class="language-shell line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">shell</span><pre class="shiki material-theme-palenight vp-code" tabindex="0"><code><span class="line"><span style="color:#FFCB6B;">helm</span><span style="color:#C3E88D;"> install</span><span style="color:#C3E88D;"> zhangling-nginx</span><span style="color:#C3E88D;"> .</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br></div></div><p>查看详细信息</p><div class="language-shell line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">shell</span><pre class="shiki material-theme-palenight vp-code" tabindex="0"><code><span class="line"><span style="color:#FFCB6B;">helm</span><span style="color:#C3E88D;"> status</span><span style="color:#C3E88D;"> webserver</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br></div></div><p>查看分配到的IP，再访问服务</p><div class="language-shell line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">shell</span><pre class="shiki material-theme-palenight vp-code" tabindex="0"><code><span class="line"><span style="color:#FFCB6B;">kubectl</span><span style="color:#C3E88D;"> get</span><span style="color:#C3E88D;"> all</span></span>
<span class="line"><span style="color:#FFCB6B;">curl</span><span style="color:#C3E88D;"> 查看到的ip</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><h2 id="自定义chart" tabindex="-1">自定义chart <a class="header-anchor" href="#自定义chart" aria-label="Permalink to &quot;自定义chart&quot;">​</a></h2><p>自定义选项是因为并不是所有的 chart 都能按照默认配置运行成功，可能会需要一些环境 依赖，例如 PV。 所以我们需要自定义 chart 配置选项，安装过程中有两种方法可以传递配置数据：</p><p>--values（或-f）：指定带有覆盖的 YAML 文件。这可以多次指定，最右边的文件 优先</p><p>--set：在命令行上指定替代。如果两者都用，--set 优先级高</p><h3 id="第一步-使用命令创建chart" tabindex="-1">第一步：使用命令创建chart <a class="header-anchor" href="#第一步-使用命令创建chart" aria-label="Permalink to &quot;第一步：使用命令创建chart&quot;">​</a></h3><p>helm create chart名称 名称以<code>zhangling-chart</code>为例</p><div class="language-shell line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">shell</span><pre class="shiki material-theme-palenight vp-code" tabindex="0"><code><span class="line"><span style="color:#FFCB6B;">helm</span><span style="color:#C3E88D;"> create</span><span style="color:#C3E88D;"> zhangling-chart</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br></div></div><p>创建成功后,包括4个文件/文件夹</p><p><code>charts Chart.yaml templates values.yaml</code></p><p>命令查看目录结构</p><div class="language-shell line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">shell</span><pre class="shiki material-theme-palenight vp-code" tabindex="0"><code><span class="line"><span style="color:#FFCB6B;">tree</span><span style="color:#C3E88D;"> .</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br></div></div><div class="language-text line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">text</span><pre class="shiki material-theme-palenight vp-code" tabindex="0"><code><span class="line"><span>.</span></span>
<span class="line"><span>├── charts</span></span>
<span class="line"><span>├── Chart.yaml</span></span>
<span class="line"><span>├── templates</span></span>
<span class="line"><span>│   ├── deployment.yaml</span></span>
<span class="line"><span>│   ├── _helpers.tpl</span></span>
<span class="line"><span>│   ├── hpa.yaml</span></span>
<span class="line"><span>│   ├── ingress.yaml</span></span>
<span class="line"><span>│   ├── NOTES.txt</span></span>
<span class="line"><span>│   ├── serviceaccount.yaml</span></span>
<span class="line"><span>│   ├── service.yaml</span></span>
<span class="line"><span>│   └── tests</span></span>
<span class="line"><span>│       └── test-connection.yaml</span></span>
<span class="line"><span>└── values.yaml</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br></div></div><div class="tip custom-block"><p class="custom-block-title">分析一下相关目录的含义：</p><p>charts：普通文件夹，刚开始创建为空</p><p>Chart.yaml：用于配置当前chart的属性信息，可以作为全局变量提供给模板文件使用</p><p>templates：目标信息文件，里面有很多的yaml模板文件，我们使用helm创建应用相当于helm帮我去执行这些yaml文件了。</p><p>values.yaml：全局变量文件，提供给templates里面的yaml文件用</p></div><h3 id="第二步-在templates文件夹中创建两个yaml文件" tabindex="-1">第二步：在templates文件夹中创建两个yaml文件 <a class="header-anchor" href="#第二步-在templates文件夹中创建两个yaml文件" aria-label="Permalink to &quot;第二步：在templates文件夹中创建两个yaml文件&quot;">​</a></h3><p>为了方便得到service.yaml，我们事先创建了一个<code>zhangling-service</code>的服务，得到service.yaml文件之后，再删除这个服务。</p><h3 id="第三步-开始安装mychart" tabindex="-1">第三步：开始安装mychart <a class="header-anchor" href="#第三步-开始安装mychart" aria-label="Permalink to &quot;第三步：开始安装mychart&quot;">​</a></h3><div class="language-shell line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">shell</span><pre class="shiki material-theme-palenight vp-code" tabindex="0"><code><span class="line"><span style="color:#FFCB6B;">helm</span><span style="color:#C3E88D;"> install</span><span style="color:#C3E88D;"> zhangling-service</span><span style="color:#C3E88D;"> zhangling-chart/</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br></div></div><h3 id="第四步-更新应用" tabindex="-1">第四步：更新应用 <a class="header-anchor" href="#第四步-更新应用" aria-label="Permalink to &quot;第四步：更新应用&quot;">​</a></h3><p>helm upgrade chart名称</p><div class="language-shell line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">shell</span><pre class="shiki material-theme-palenight vp-code" tabindex="0"><code><span class="line"><span style="color:#FFCB6B;">helm</span><span style="color:#C3E88D;"> upgrade</span><span style="color:#C3E88D;"> zhangling-service</span><span style="color:#C3E88D;"> zhangling-chart/</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br></div></div><p>更新应用的话，一般更新我们的宏定义变量</p><h3 id="第五步-删除应用" tabindex="-1">第五步：删除应用 <a class="header-anchor" href="#第五步-删除应用" aria-label="Permalink to &quot;第五步：删除应用&quot;">​</a></h3><div class="language-shell line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">shell</span><pre class="shiki material-theme-palenight vp-code" tabindex="0"><code><span class="line"><span style="color:#FFCB6B;">helm</span><span style="color:#C3E88D;"> uninstall</span><span style="color:#C3E88D;"> xxx</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br></div></div><h2 id="chart-yaml文件" tabindex="-1">Chart.yaml文件 <a class="header-anchor" href="#chart-yaml文件" aria-label="Permalink to &quot;Chart.yaml文件&quot;">​</a></h2><div class="language-shell line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">shell</span><pre class="shiki material-theme-palenight vp-code" tabindex="0"><code><span class="line"><span style="color:#FFCB6B;">apiVersion:</span><span style="color:#676E95;font-style:italic;"> 			# chart API 版本信息, 通常是 &quot;v1&quot; (必须)</span></span>
<span class="line"><span style="color:#FFCB6B;">name:</span><span style="color:#676E95;font-style:italic;"> 					# chart 的名称 (必须)</span></span>
<span class="line"><span style="color:#FFCB6B;">version:</span><span style="color:#676E95;font-style:italic;"> 				# chart 包的版本 (必须)</span></span>
<span class="line"><span style="color:#FFCB6B;">kubeVersion:</span><span style="color:#676E95;font-style:italic;"> 			# 指定 Kubernetes 版本 (可选)</span></span>
<span class="line"><span style="color:#82AAFF;">type</span><span style="color:#C3E88D;">:</span><span style="color:#676E95;font-style:italic;"> 					# chart类型 （可选）</span></span>
<span class="line"><span style="color:#FFCB6B;">description:</span><span style="color:#676E95;font-style:italic;"> 			# 对项目的描述 (可选)</span></span>
<span class="line"><span style="color:#FFCB6B;">keywords:</span></span>
<span class="line"><span style="color:#FFCB6B;">  -</span><span style="color:#676E95;font-style:italic;"> 					# 有关于项目的一些关键字 (可选)</span></span>
<span class="line"><span style="color:#FFCB6B;">home:</span><span style="color:#676E95;font-style:italic;"> 					# 项目 HOME 页面的 URL 地址 (可选)</span></span>
<span class="line"><span style="color:#FFCB6B;">sources:</span></span>
<span class="line"><span style="color:#FFCB6B;">  -</span><span style="color:#676E95;font-style:italic;"> 					# 项目源码的 URL 地址 (可选)</span></span>
<span class="line"><span style="color:#FFCB6B;">dependencies:</span><span style="color:#676E95;font-style:italic;"> 			# chart 必要条件列表 （可选）</span></span>
<span class="line"><span style="color:#FFCB6B;">  -</span><span style="color:#C3E88D;"> name:</span><span style="color:#676E95;font-style:italic;"> 				# chart名称 (nginx)</span></span>
<span class="line"><span style="color:#FFCB6B;">    version:</span><span style="color:#676E95;font-style:italic;"> 			# chart版本 (&quot;1.2.3&quot;)</span></span>
<span class="line"><span style="color:#FFCB6B;">    repository:</span><span style="color:#676E95;font-style:italic;"> 		# （可选）仓库URL (&quot;https://example.com/charts&quot;) 或别名 (&quot;@repo-name&quot;)</span></span>
<span class="line"><span style="color:#FFCB6B;">    condition:</span><span style="color:#676E95;font-style:italic;"> 			# （可选） 解析为布尔值的yaml路径，用于启用/禁用chart (e.g. subchart1.enabled )</span></span>
<span class="line"><span style="color:#FFCB6B;">    tags:</span><span style="color:#676E95;font-style:italic;"> 				# （可选）</span></span>
<span class="line"><span style="color:#FFCB6B;">      -</span><span style="color:#676E95;font-style:italic;"> 				# 用于一次启用/禁用 一组chart的tag</span></span>
<span class="line"><span style="color:#FFCB6B;">    import-values:</span><span style="color:#676E95;font-style:italic;"> 		# （可选）</span></span>
<span class="line"><span style="color:#FFCB6B;">      -</span><span style="color:#676E95;font-style:italic;"> 				# ImportValue 保存源值到导入父键的映射。每项可以是字符串或者一对子/父列表项</span></span>
<span class="line"><span style="color:#82AAFF;">    alias</span><span style="color:#C3E88D;">:</span><span style="color:#676E95;font-style:italic;"> 				# （可选） chart中使用的别名。当你要多次添加相同的chart时会很有用</span></span>
<span class="line"><span style="color:#FFCB6B;">maintainers:</span><span style="color:#676E95;font-style:italic;"> 			# （可选）维护者信息</span></span>
<span class="line"><span style="color:#FFCB6B;">  -</span><span style="color:#C3E88D;"> name:</span><span style="color:#676E95;font-style:italic;"> 				# 维护者的名称</span></span>
<span class="line"><span style="color:#FFCB6B;">    email:</span><span style="color:#676E95;font-style:italic;"> 				# 维护者的邮件地址</span></span>
<span class="line"><span style="color:#FFCB6B;">    url:</span><span style="color:#676E95;font-style:italic;"> 				# 维护者的个人主页</span></span>
<span class="line"><span style="color:#FFCB6B;">engine:</span><span style="color:#C3E88D;"> gotpl</span><span style="color:#676E95;font-style:italic;"> 			# 模板引擎的名称（可选，默认为 gotpl）</span></span>
<span class="line"><span style="color:#FFCB6B;">icon:</span><span style="color:#676E95;font-style:italic;"> 					# （可选）指定 chart 图标的 SVG 或 PNG 图像的 URL</span></span>
<span class="line"><span style="color:#FFCB6B;">appVersion:</span><span style="color:#676E95;font-style:italic;"> 			# 应用程序包含的版本</span></span>
<span class="line"><span style="color:#FFCB6B;">deprecated:</span><span style="color:#676E95;font-style:italic;"> 			# （可选，使用布尔值）该 chart 是否被废弃</span></span>
<span class="line"><span style="color:#FFCB6B;">annotations:</span></span>
<span class="line"><span style="color:#FFCB6B;">  example:</span><span style="color:#676E95;font-style:italic;"> 				# 按名称输入的批注列表 （可选）.</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br></div></div><div class="tip custom-block"><p class="custom-block-title">Chart.yaml中有两个需要注意的地方：</p><p>• version：表示Chart自己的版本号，比如说刚新建的是0.1.0，如果做了一次更新，可以把它改为0.1.1；</p><p>• appVersion：表示Chart内应用的版本号，比如我通过helm安装了kafka，appVersion就是kafka的版本号；</p><p>• apiVersion：表示helm的apiVersion，默认为v2；</p></div><h2 id="value-yaml文件" tabindex="-1">value.yaml文件 <a class="header-anchor" href="#value-yaml文件" aria-label="Permalink to &quot;value.yaml文件&quot;">​</a></h2><p>yaml文件中常用可能的参数为<code>image，tag，label，port，replicas</code>，即我们把它们当做宏定义。</p><div class="language-shell line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">shell</span><pre class="shiki material-theme-palenight vp-code" tabindex="0"><code><span class="line"><span style="color:#FFCB6B;">cat</span><span style="color:#C3E88D;"> values.yaml</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br></div></div><p>内容如下</p><div class="language-shell line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">shell</span><pre class="shiki material-theme-palenight vp-code" tabindex="0"><code><span class="line"><span style="color:#676E95;font-style:italic;"># Default values for zhangling-chart.</span></span>
<span class="line"><span style="color:#676E95;font-style:italic;"># This is a YAML-formatted file.</span></span>
<span class="line"><span style="color:#676E95;font-style:italic;"># Declare variables to be passed into your templates.</span></span>
<span class="line"><span style="color:#FFCB6B;">replicas:</span><span style="color:#F78C6C;"> 1</span></span>
<span class="line"><span style="color:#FFCB6B;">image:</span><span style="color:#C3E88D;"> nginx</span></span>
<span class="line"><span style="color:#FFCB6B;">tag:</span><span style="color:#F78C6C;"> 1.16</span></span>
<span class="line"><span style="color:#FFCB6B;">lable:</span><span style="color:#C3E88D;"> nginx</span></span>
<span class="line"><span style="color:#FFCB6B;">port:</span><span style="color:#F78C6C;"> 80</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br></div></div><div class="tip custom-block"><p class="custom-block-title">内置变量</p><p><code>.Chart.Name</code>不是取的values.yaml文件里的值，而是helm自带的内置变量。</p><p>也可以使用<code>Release.Name</code>来获取当前release名称（install后的zhangling-chart就是Release.Name的名称）：</p><p>Release Name：实例的名称，helm install指定的名字</p><p>Release.Namespace：应用实例的命名空间</p><p>Release.IsUpgrade： 如果当前对实例的操作是更新或者回滚，这个变量的值就会被置为true</p><p>Release.Islnstall：如果当前对实例的操作是安装，则这边变量被置为true</p><p>Release.Revision：此次修订的版本号，从1开始，每次升 级回滚都会增加1</p><p>Chart：Chart.yaml文件中的内容，可以使用</p><p>Chart.Version：表示应用版本，Chart.Name表示Chart的名称</p></div><h2 id="基于已有的chart制作新的chart" tabindex="-1">基于已有的chart制作新的chart <a class="header-anchor" href="#基于已有的chart制作新的chart" aria-label="Permalink to &quot;基于已有的chart制作新的chart&quot;">​</a></h2><p>eg: nfs-subdir-external-provisioner-4.0.18.tgz</p><div class="language-shell line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">shell</span><pre class="shiki material-theme-palenight vp-code" tabindex="0"><code><span class="line"><span style="color:#FFCB6B;">curl</span><span style="color:#C3E88D;"> -o</span><span style="color:#C3E88D;"> https://github.com/kubernetes-sigs/nfs-subdir-external-provisioner/releases/download/nfs-subdir-external-provisioner-4.0.18/nfs-subdir-external-provisioner-4.0.18.tgz</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br></div></div><div class="language-shell line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">shell</span><pre class="shiki material-theme-palenight vp-code" tabindex="0"><code><span class="line"><span style="color:#FFCB6B;">tar</span><span style="color:#C3E88D;"> -zxf</span><span style="color:#C3E88D;"> nfs-subdir-external-provisioner-4.0.18.tgz</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br></div></div><div class="language-shell line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">shell</span><pre class="shiki material-theme-palenight vp-code" tabindex="0"><code><span class="line"><span style="color:#82AAFF;">cd</span><span style="color:#C3E88D;"> nfs-subdir-external-provisioner/</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br></div></div><p>编辑Chart.yaml</p><div class="language-shell line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">shell</span><pre class="shiki material-theme-palenight vp-code" tabindex="0"><code><span class="line"><span style="color:#FFCB6B;">vi</span><span style="color:#C3E88D;"> Chart.yaml</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br></div></div><div class="language-shell line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">shell</span><pre class="shiki material-theme-palenight vp-code" tabindex="0"><code><span class="line"><span style="color:#FFCB6B;">apiVersion:</span><span style="color:#C3E88D;"> v1</span></span>
<span class="line"><span style="color:#FFCB6B;">appVersion:</span><span style="color:#F78C6C;"> 4.0.2</span></span>
<span class="line"><span style="color:#FFCB6B;">description:</span><span style="color:#C3E88D;"> nfs-subdir-external-provisioner</span><span style="color:#C3E88D;"> is</span><span style="color:#C3E88D;"> an</span><span style="color:#C3E88D;"> automatic</span><span style="color:#C3E88D;"> provisioner</span><span style="color:#C3E88D;"> that</span><span style="color:#C3E88D;"> used</span><span style="color:#C3E88D;"> your</span><span style="color:#BABED8;"> *</span><span style="color:#C3E88D;">already</span><span style="color:#C3E88D;"> configured</span><span style="color:#BABED8;">*</span><span style="color:#C3E88D;"> NFS</span><span style="color:#C3E88D;"> server,</span><span style="color:#C3E88D;"> automatically</span><span style="color:#C3E88D;"> creating</span><span style="color:#C3E88D;"> Persistent</span><span style="color:#C3E88D;"> Volumes.</span></span>
<span class="line"><span style="color:#FFCB6B;">home:</span><span style="color:#C3E88D;"> https://github.com/kubernetes-sigs/nfs-subdir-external-provisioner</span></span>
<span class="line"><span style="color:#FFCB6B;">keywords:</span></span>
<span class="line"><span style="color:#FFCB6B;">-</span><span style="color:#C3E88D;"> nfs</span></span>
<span class="line"><span style="color:#FFCB6B;">-</span><span style="color:#C3E88D;"> storage</span></span>
<span class="line"><span style="color:#FFCB6B;">-</span><span style="color:#C3E88D;"> provisioner</span></span>
<span class="line"><span style="color:#FFCB6B;">kubeVersion:</span><span style="color:#89DDFF;"> &#39;</span><span style="color:#C3E88D;">&gt;=1.9.0-0</span><span style="color:#89DDFF;">&#39;</span></span>
<span class="line"><span style="color:#FFCB6B;">name:</span><span style="color:#C3E88D;"> nfs-subdir-external-provisioner-zl-25-42</span><span style="color:#89DDFF;">  \`</span><span style="color:#FFCB6B;">修改点</span><span style="color:#89DDFF;">\`</span><span style="color:#676E95;font-style:italic;"> #原先nfs-subdir-external-provisioner</span></span>
<span class="line"><span style="color:#FFCB6B;">sources:</span></span>
<span class="line"><span style="color:#FFCB6B;">-</span><span style="color:#C3E88D;"> https://github.com/kubernetes-sigs/nfs-subdir-external-provisioner</span></span>
<span class="line"><span style="color:#FFCB6B;">version:</span><span style="color:#F78C6C;"> 4.0.18</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br></div></div><p>编辑values.yaml</p><div class="language-shell line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">shell</span><pre class="shiki material-theme-palenight vp-code" tabindex="0"><code><span class="line"><span style="color:#FFCB6B;">vi</span><span style="color:#C3E88D;"> values.yaml</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br></div></div><div class="language-shell line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">shell</span><pre class="shiki material-theme-palenight vp-code" tabindex="0"><code><span class="line"><span style="color:#FFCB6B;">replicaCount:</span><span style="color:#F78C6C;"> 1</span></span>
<span class="line"><span style="color:#FFCB6B;">strategyType:</span><span style="color:#C3E88D;"> Recreate</span></span>
<span class="line"></span>
<span class="line"><span style="color:#FFCB6B;">image:</span></span>
<span class="line"><span style="color:#FFCB6B;">  repository:</span><span style="color:#C3E88D;"> registry.k8s.io/sig-storage/nfs-subdir-external-provisioner</span></span>
<span class="line"><span style="color:#FFCB6B;">  tag:</span><span style="color:#C3E88D;"> v4.0.2</span></span>
<span class="line"><span style="color:#FFCB6B;">  pullPolicy:</span><span style="color:#C3E88D;"> IfNotPresent</span></span>
<span class="line"><span style="color:#FFCB6B;">imagePullSecrets:</span><span style="color:#BABED8;"> []</span></span>
<span class="line"></span>
<span class="line"><span style="color:#FFCB6B;">nfs:</span></span>
<span class="line"><span style="color:#FFCB6B;">  server:</span></span>
<span class="line"><span style="color:#FFCB6B;">  path:</span><span style="color:#C3E88D;"> /nfs-storage</span></span>
<span class="line"><span style="color:#FFCB6B;">  mountOptions:</span></span>
<span class="line"><span style="color:#FFCB6B;">  volumeName:</span><span style="color:#C3E88D;"> nfs-subdir-external-provisioner-root</span></span>
<span class="line"><span style="color:#676E95;font-style:italic;">  # Reclaim policy for the main nfs volume</span></span>
<span class="line"><span style="color:#FFCB6B;">  reclaimPolicy:</span><span style="color:#C3E88D;"> Retain</span></span>
<span class="line"></span>
<span class="line"><span style="color:#676E95;font-style:italic;"># For creating the StorageClass automatically:</span></span>
<span class="line"><span style="color:#FFCB6B;">storageClass:</span></span>
<span class="line"><span style="color:#FFCB6B;">  create:</span><span style="color:#89DDFF;"> true</span></span>
<span class="line"></span>
<span class="line"><span style="color:#676E95;font-style:italic;">  # Set a provisioner name. If unset, a name will be generated.</span></span>
<span class="line"><span style="color:#676E95;font-style:italic;">  # provisionerName:</span></span>
<span class="line"></span>
<span class="line"><span style="color:#676E95;font-style:italic;">  # Set StorageClass as the default StorageClass</span></span>
<span class="line"><span style="color:#676E95;font-style:italic;">  # Ignored if storageClass.create is false</span></span>
<span class="line"><span style="color:#FFCB6B;">  defaultClass:</span><span style="color:#89DDFF;"> false</span></span>
<span class="line"></span>
<span class="line"><span style="color:#676E95;font-style:italic;">  # Set a StorageClass name</span></span>
<span class="line"><span style="color:#676E95;font-style:italic;">  # Ignored if storageClass.create is false</span></span>
<span class="line"><span style="color:#FFCB6B;">  name:</span><span style="color:#C3E88D;"> nfs-client-zhangling-172-26-25-42</span><span style="color:#89DDFF;">  \`</span><span style="color:#FFCB6B;">修改点</span><span style="color:#89DDFF;">\`</span><span style="color:#676E95;font-style:italic;"> #原先nfs-client</span></span>
<span class="line"></span>
<span class="line"><span style="color:#676E95;font-style:italic;">  # Allow volume to be expanded dynamically</span></span>
<span class="line"><span style="color:#FFCB6B;">  allowVolumeExpansion:</span><span style="color:#89DDFF;"> true</span></span>
<span class="line"></span>
<span class="line"><span style="color:#676E95;font-style:italic;">  # Method used to reclaim an obsoleted volume</span></span>
<span class="line"><span style="color:#FFCB6B;">  reclaimPolicy:</span><span style="color:#C3E88D;"> Delete</span></span>
<span class="line"></span>
<span class="line"><span style="color:#676E95;font-style:italic;">  # When set to false your PVs will not be archived by the provisioner upon deletion of the PVC.</span></span>
<span class="line"><span style="color:#FFCB6B;">  archiveOnDelete:</span><span style="color:#89DDFF;"> true</span></span>
<span class="line"></span>
<span class="line"><span style="color:#676E95;font-style:italic;">  # If it exists and has &#39;delete&#39; value, delete the directory. If it exists and has &#39;retain&#39; value, save the directory.</span></span>
<span class="line"><span style="color:#676E95;font-style:italic;">  # Overrides archiveOnDelete.</span></span>
<span class="line"><span style="color:#676E95;font-style:italic;">  # Ignored if value not set.</span></span>
<span class="line"><span style="color:#FFCB6B;">  onDelete:</span></span>
<span class="line"></span>
<span class="line"><span style="color:#676E95;font-style:italic;">  # Specifies a template for creating a directory path via PVC metadata&#39;s such as labels, annotations, name or namespace.</span></span>
<span class="line"><span style="color:#676E95;font-style:italic;">  # Ignored if value not set.</span></span>
<span class="line"><span style="color:#FFCB6B;">  pathPattern:</span></span>
<span class="line"></span>
<span class="line"><span style="color:#676E95;font-style:italic;">  # Set access mode - ReadWriteOnce, ReadOnlyMany or ReadWriteMany</span></span>
<span class="line"><span style="color:#FFCB6B;">  accessModes:</span><span style="color:#C3E88D;"> ReadWriteOnce</span></span>
<span class="line"></span>
<span class="line"><span style="color:#676E95;font-style:italic;">  # Set volume bindinng mode - Immediate or WaitForFirstConsumer</span></span>
<span class="line"><span style="color:#FFCB6B;">  volumeBindingMode:</span><span style="color:#C3E88D;"> Immediate</span></span>
<span class="line"></span>
<span class="line"><span style="color:#676E95;font-style:italic;">  # Storage class annotations</span></span>
<span class="line"><span style="color:#FFCB6B;">  annotations:</span><span style="color:#C3E88D;"> {}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#FFCB6B;">leaderElection:</span></span>
<span class="line"><span style="color:#676E95;font-style:italic;">  # When set to false leader election will be disabled</span></span>
<span class="line"><span style="color:#FFCB6B;">  enabled:</span><span style="color:#89DDFF;"> true</span></span>
<span class="line"></span>
<span class="line"><span style="color:#676E95;font-style:italic;">## For RBAC support:</span></span>
<span class="line"><span style="color:#FFCB6B;">rbac:</span></span>
<span class="line"><span style="color:#676E95;font-style:italic;">  # Specifies whether RBAC resources should be created</span></span>
<span class="line"><span style="color:#FFCB6B;">  create:</span><span style="color:#89DDFF;"> true</span></span>
<span class="line"></span>
<span class="line"><span style="color:#676E95;font-style:italic;"># If true, create &amp; use Pod Security Policy resources</span></span>
<span class="line"><span style="color:#676E95;font-style:italic;"># https://kubernetes.io/docs/concepts/policy/pod-security-policy/</span></span>
<span class="line"><span style="color:#FFCB6B;">podSecurityPolicy:</span></span>
<span class="line"><span style="color:#FFCB6B;">  enabled:</span><span style="color:#89DDFF;"> false</span></span>
<span class="line"></span>
<span class="line"><span style="color:#676E95;font-style:italic;"># Deployment pod annotations</span></span>
<span class="line"><span style="color:#FFCB6B;">podAnnotations:</span><span style="color:#C3E88D;"> {}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#676E95;font-style:italic;">## Set pod priorityClassName</span></span>
<span class="line"><span style="color:#676E95;font-style:italic;"># priorityClassName: &quot;&quot;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#FFCB6B;">podSecurityContext:</span><span style="color:#C3E88D;"> {}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#FFCB6B;">securityContext:</span><span style="color:#C3E88D;"> {}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#FFCB6B;">serviceAccount:</span></span>
<span class="line"><span style="color:#676E95;font-style:italic;">  # Specifies whether a ServiceAccount should be created</span></span>
<span class="line"><span style="color:#FFCB6B;">  create:</span><span style="color:#89DDFF;"> true</span></span>
<span class="line"></span>
<span class="line"><span style="color:#676E95;font-style:italic;">  # Annotations to add to the service account</span></span>
<span class="line"><span style="color:#FFCB6B;">  annotations:</span><span style="color:#C3E88D;"> {}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#676E95;font-style:italic;">  # The name of the ServiceAccount to use.</span></span>
<span class="line"><span style="color:#676E95;font-style:italic;">  # If not set and create is true, a name is generated using the fullname template</span></span>
<span class="line"><span style="color:#FFCB6B;">  name:</span></span>
<span class="line"></span>
<span class="line"><span style="color:#FFCB6B;">resources:</span><span style="color:#C3E88D;"> {}</span></span>
<span class="line"><span style="color:#676E95;font-style:italic;">  # limits:</span></span>
<span class="line"><span style="color:#676E95;font-style:italic;">  #  cpu: 100m</span></span>
<span class="line"><span style="color:#676E95;font-style:italic;">  #  memory: 128Mi</span></span>
<span class="line"><span style="color:#676E95;font-style:italic;">  # requests:</span></span>
<span class="line"><span style="color:#676E95;font-style:italic;">  #  cpu: 100m</span></span>
<span class="line"><span style="color:#676E95;font-style:italic;">  #  memory: 128Mi</span></span>
<span class="line"></span>
<span class="line"><span style="color:#FFCB6B;">nodeSelector:</span><span style="color:#C3E88D;"> {}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#FFCB6B;">tolerations:</span><span style="color:#BABED8;"> []</span></span>
<span class="line"></span>
<span class="line"><span style="color:#FFCB6B;">affinity:</span><span style="color:#C3E88D;"> {}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#676E95;font-style:italic;"># Additional labels for any resource created</span></span>
<span class="line"><span style="color:#FFCB6B;">labels:</span><span style="color:#C3E88D;"> {}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#FFCB6B;">podDisruptionBudget:</span></span>
<span class="line"><span style="color:#FFCB6B;">  enabled:</span><span style="color:#89DDFF;"> false</span></span>
<span class="line"><span style="color:#FFCB6B;">  maxUnavailable:</span><span style="color:#F78C6C;"> 1</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br><span class="line-number">39</span><br><span class="line-number">40</span><br><span class="line-number">41</span><br><span class="line-number">42</span><br><span class="line-number">43</span><br><span class="line-number">44</span><br><span class="line-number">45</span><br><span class="line-number">46</span><br><span class="line-number">47</span><br><span class="line-number">48</span><br><span class="line-number">49</span><br><span class="line-number">50</span><br><span class="line-number">51</span><br><span class="line-number">52</span><br><span class="line-number">53</span><br><span class="line-number">54</span><br><span class="line-number">55</span><br><span class="line-number">56</span><br><span class="line-number">57</span><br><span class="line-number">58</span><br><span class="line-number">59</span><br><span class="line-number">60</span><br><span class="line-number">61</span><br><span class="line-number">62</span><br><span class="line-number">63</span><br><span class="line-number">64</span><br><span class="line-number">65</span><br><span class="line-number">66</span><br><span class="line-number">67</span><br><span class="line-number">68</span><br><span class="line-number">69</span><br><span class="line-number">70</span><br><span class="line-number">71</span><br><span class="line-number">72</span><br><span class="line-number">73</span><br><span class="line-number">74</span><br><span class="line-number">75</span><br><span class="line-number">76</span><br><span class="line-number">77</span><br><span class="line-number">78</span><br><span class="line-number">79</span><br><span class="line-number">80</span><br><span class="line-number">81</span><br><span class="line-number">82</span><br><span class="line-number">83</span><br><span class="line-number">84</span><br><span class="line-number">85</span><br><span class="line-number">86</span><br><span class="line-number">87</span><br><span class="line-number">88</span><br><span class="line-number">89</span><br><span class="line-number">90</span><br><span class="line-number">91</span><br><span class="line-number">92</span><br><span class="line-number">93</span><br><span class="line-number">94</span><br><span class="line-number">95</span><br><span class="line-number">96</span><br><span class="line-number">97</span><br><span class="line-number">98</span><br><span class="line-number">99</span><br><span class="line-number">100</span><br><span class="line-number">101</span><br><span class="line-number">102</span><br><span class="line-number">103</span><br><span class="line-number">104</span><br><span class="line-number">105</span><br><span class="line-number">106</span><br><span class="line-number">107</span><br><span class="line-number">108</span><br><span class="line-number">109</span><br><span class="line-number">110</span><br><span class="line-number">111</span><br><span class="line-number">112</span><br><span class="line-number">113</span><br><span class="line-number">114</span><br></div></div><p>安装 helm install xxx .(当前目录) # 172.26.22.107上有自定义的chart (目录: /zhangling/k8s-yamls/nfs-subdir-external-provisioner-custom)</p><div class="language-shell line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">shell</span><pre class="shiki material-theme-palenight vp-code" tabindex="0"><code><span class="line"><span style="color:#FFCB6B;">helm</span><span style="color:#C3E88D;"> install</span><span style="color:#C3E88D;"> nfs-subdir-external-provisioner-zl-25-42</span><span style="color:#C3E88D;"> .</span><span style="color:#C3E88D;"> -n</span><span style="color:#C3E88D;"> kube-system</span><span style="color:#C3E88D;"> --set</span><span style="color:#C3E88D;"> image.repository=k8s.gcr.io/sig-storage/nfs-subdir-external-provisioner</span><span style="color:#C3E88D;"> --set</span><span style="color:#C3E88D;"> nfs.server=</span><span style="color:#F78C6C;">172.26.25.42</span><span style="color:#C3E88D;"> --set</span><span style="color:#C3E88D;"> nfs.path=/nfs-zhangling</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br></div></div><p>Harbor镜像</p><div class="language-shell line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">shell</span><pre class="shiki material-theme-palenight vp-code" tabindex="0"><code><span class="line"><span style="color:#FFCB6B;">helm</span><span style="color:#C3E88D;"> install</span><span style="color:#C3E88D;"> nfs-subdir-external-provisioner-zl-25-42</span><span style="color:#C3E88D;"> .</span><span style="color:#C3E88D;"> -n</span><span style="color:#C3E88D;"> kube-system</span><span style="color:#C3E88D;"> --set</span><span style="color:#C3E88D;"> image.repository=172.26.25.7:8070/custom/nfs-subdir-external-provisioner</span><span style="color:#C3E88D;"> --set</span><span style="color:#C3E88D;"> image.tag=v4.0.0</span><span style="color:#C3E88D;"> --set</span><span style="color:#C3E88D;"> nfs.server=</span><span style="color:#F78C6C;">172.26.25.42</span><span style="color:#C3E88D;">   --set</span><span style="color:#C3E88D;"> nfs.path=/nfs-zhangling</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br></div></div><div class="language-shell line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">shell</span><pre class="shiki material-theme-palenight vp-code" tabindex="0"><code><span class="line"><span style="color:#FFCB6B;">helm</span><span style="color:#C3E88D;"> uninstall</span><span style="color:#C3E88D;"> nfs-subdir-external-provisioner-zl-25-42</span><span style="color:#C3E88D;"> -n</span><span style="color:#C3E88D;"> kube-system</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br></div></div>`,97),o=[r];function c(i,b,m,d,y,u){return n(),a("div",null,o)}const F=s(t,[["render",c]]);export{C as __pageData,F as default};
