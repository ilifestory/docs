import{_ as a,c as e,o as s,a4 as n}from"./chunks/framework.CCJHkvW2.js";const g=JSON.parse('{"title":"docker 安装mongodb","description":"","frontmatter":{},"headers":[],"relativePath":"tool/mongodb.md","filePath":"tool/mongodb.md","lastUpdated":1707190539000}'),d={name:"tool/mongodb.md"},i=n('<h1 id="docker-安装mongodb" tabindex="-1">docker 安装mongodb <a class="header-anchor" href="#docker-安装mongodb" aria-label="Permalink to &quot;docker 安装mongodb&quot;">​</a></h1><div class="language- line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki material-theme-palenight vp-code" tabindex="0"><code><span class="line"><span>mkdir -p /mongodb/data</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br></div></div><div class="language- line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki material-theme-palenight vp-code" tabindex="0"><code><span class="line"><span>docker pull mongo</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br></div></div><div class="language- line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki material-theme-palenight vp-code" tabindex="0"><code><span class="line"><span>docker run -d --name mongodb --restart=always -v /mongodb/data:/data/db -p 27017:27017 --privileged=true mongo:latest</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br></div></div><h2 id="mongodb分片集群" tabindex="-1">mongoDB分片集群 <a class="header-anchor" href="#mongodb分片集群" aria-label="Permalink to &quot;mongoDB分片集群&quot;">​</a></h2><h2 id="配置集群" tabindex="-1">配置集群 <a class="header-anchor" href="#配置集群" aria-label="Permalink to &quot;配置集群&quot;">​</a></h2><div class="language- line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki material-theme-palenight vp-code" tabindex="0"><code><span class="line"><span>docker run -d  --name configMaster  --restart always  --privileged  -p 17017:27019  -v /docker/mongodb/configMaster/data/db:/data/db -v /docker/mongodb/configMaster/data/configdb:/data/configdb  mongo:latest   --replSet  rs_config_server --configsvr --bind_ip_all  --port 27019</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br></div></div><div class="language- line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki material-theme-palenight vp-code" tabindex="0"><code><span class="line"><span>docker run -d  --name configSlave1 --restart always  --privileged  -p 17018:27019  -v /docker/mongodb/configSlave1/data/db:/data/db -v /docker/mongodb/configSlave1/data/configdb:/data/configdb mongo:latest --bind_ip_all --replSet  rs_config_server --configsvr  --port 27019</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br></div></div><div class="language- line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki material-theme-palenight vp-code" tabindex="0"><code><span class="line"><span>docker run -d  --name configSlave2 --restart always  --privileged  -p 17019:27019  -v /docker/mongodb/configSlave2/data/db:/data/db -v /docker/mongodb/configSlave2/data/configdb:/data/configdb mongo:latest --bind_ip_all --replSet  rs_config_server --configsvr --port 27019</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br></div></div><div class="language- line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki material-theme-palenight vp-code" tabindex="0"><code><span class="line"><span>docker exec -it configMaster mongo -port 27019</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br></div></div><div class="language- line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki material-theme-palenight vp-code" tabindex="0"><code><span class="line"><span>rs.initiate( {     _id: &quot;rs_config_server&quot;,     configsvr: true,     members: [         { _id : 0, host : &quot;172.26.25.16:17017&quot; },         { _id : 1, host : &quot;172.26.25.16:17018&quot; },         { _id : 2, host : &quot;172.26.25.16:17019&quot; }     ] })</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br></div></div><h2 id="分片集群" tabindex="-1">分片集群 <a class="header-anchor" href="#分片集群" aria-label="Permalink to &quot;分片集群&quot;">​</a></h2><h3 id="分片一" tabindex="-1">分片一 <a class="header-anchor" href="#分片一" aria-label="Permalink to &quot;分片一&quot;">​</a></h3><div class="language- line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki material-theme-palenight vp-code" tabindex="0"><code><span class="line"><span>docker run -d  --name shardMaster1  --restart always  --privileged  -p 27017:27018  -v /docker/mongodb/shardMaster1/data/db:/data/db -v /docker/mongodb/shardMaster1/data/configdb:/data/configdb mongo:latest --bind_ip_all --replSet rs_shard_server1 --shardsvr --port 27018</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br></div></div><div class="language- line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki material-theme-palenight vp-code" tabindex="0"><code><span class="line"><span>docker run -d  --name shardSlave11  --restart always  --privileged  -p 27018:27018  -v /docker/mongodb/shardSlave11/data/db:/data/db -v /docker/mongodb/shardSlave11/data/configdb:/data/configdb mongo:latest --bind_ip_all --replSet rs_shard_server1 --shardsvr --port 27018</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br></div></div><div class="language- line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki material-theme-palenight vp-code" tabindex="0"><code><span class="line"><span>docker run -d  --name shardSlave12  --restart always  --privileged  -p 27019:27018  -v /docker/mongodb/shardSlave12/data/db:/data/db -v /docker/mongodb/shardSlave12/data/configdb:/data/configdb mongo:latest --bind_ip_all --replSet rs_shard_server1 --shardsvr --port 27018</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br></div></div><div class="language- line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki material-theme-palenight vp-code" tabindex="0"><code><span class="line"><span>docker exec -it shardMaster1 mongo -port 27018</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br></div></div><div class="language- line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki material-theme-palenight vp-code" tabindex="0"><code><span class="line"><span>rs.initiate( { _id : &quot;rs_shard_server1&quot;,     members: [         { _id : 0, host : &quot;172.26.25.16:27017&quot; },         { _id : 1, host : &quot;172.26.25.16:27018&quot; },         { _id : 2, host : &quot;172.26.25.16:27019&quot; }     ] })</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br></div></div><h3 id="分片二" tabindex="-1">分片二 <a class="header-anchor" href="#分片二" aria-label="Permalink to &quot;分片二&quot;">​</a></h3><div class="language- line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki material-theme-palenight vp-code" tabindex="0"><code><span class="line"><span>docker run -d  --name shardMaster2  --restart always  --privileged  -p 27027:27018  -v /docker/mongodb/shardMaster2/data/db:/data/db -v /docker/mongodb/shardMaster2/data/configdb:/data/configdb  mongo:latest --bind_ip_all --replSet rs_shard_server2 --shardsvr --port 27018</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br></div></div><div class="language- line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki material-theme-palenight vp-code" tabindex="0"><code><span class="line"><span>docker run -d  --name shardSlave21  --restart always  --privileged  -p 27028:27018  -v /docker/mongodb/shardSlave21/data/db:/data/db -v /docker/mongodb/shardSlave21/data/configdb:/data/configdb mongo:latest --bind_ip_all --replSet rs_shard_server2 --shardsvr --port 27018</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br></div></div><div class="language- line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki material-theme-palenight vp-code" tabindex="0"><code><span class="line"><span>docker run -d  --name shardSlave22  --restart always  --privileged  -p 27029:27018  -v /docker/mongodb/shardSlave22/data/db:/data/db -v /docker/mongodb/shardSlave22/data/configdb:/data/configdb  mongo:latest --bind_ip_all --replSet rs_shard_server2 --shardsvr --port 27018</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br></div></div><div class="language- line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki material-theme-palenight vp-code" tabindex="0"><code><span class="line"><span>docker exec -it shardMaster2 mongo -port 27018</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br></div></div><div class="language- line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki material-theme-palenight vp-code" tabindex="0"><code><span class="line"><span>rs.initiate( { _id : &quot;rs_shard_server2&quot;,     members: [         { _id : 0, host : &quot;172.26.25.16:27027&quot; },         { _id : 1, host : &quot;172.26.25.16:27028&quot; },         { _id : 2, host : &quot;172.26.25.16:27029&quot; }     ] })</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br></div></div><h2 id="路由" tabindex="-1">路由 <a class="header-anchor" href="#路由" aria-label="Permalink to &quot;路由&quot;">​</a></h2><p><s>docker run -d --name routerServer1 --restart always --privileged -p 37017:27017 -v /docker/mongodb/shardSlave22/data:/data/db -e MONGO_INITDB_ROOT_USERNAME=otn -e MONGO_INITDB_ROOT_PASSWORD=Otn2020! mongo:latest --entrypoint &quot;mongos&quot; --auth --configdb rs_config_server/172.26.25.16:17017,172.26.25.16:17018,172.26.25.16:17019 --bind_ip_all</s></p><div class="language- line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki material-theme-palenight vp-code" tabindex="0"><code><span class="line"><span>docker run -d  --name gateway  --restart always  --privileged  -p 37017:27017 --entrypoint &quot;mongos&quot;  -v /docker/mongodb/gateway/data/db:/data/db -v /docker/mongodb/gateway/data/configdb:/data/configdb  mongo:latest --configdb rs_config_server/172.26.25.16:17017,172.26.25.16:17018,172.26.25.16:17019 --bind_ip_all</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br></div></div><div class="language- line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki material-theme-palenight vp-code" tabindex="0"><code><span class="line"><span>docker exec -it gateway mongo -port 27017</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br></div></div><div class="language- line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki material-theme-palenight vp-code" tabindex="0"><code><span class="line"><span>sh.addShard(&quot;rs_shard_server1/172.26.25.16:27017,172.26.25.16:27018,172.26.25.16:27019&quot;)</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br></div></div><div class="language- line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki material-theme-palenight vp-code" tabindex="0"><code><span class="line"><span>sh.addShard(&quot;rs_shard_server2/172.26.25.16:27027,172.26.25.16:27028,172.26.25.16:27029&quot;)</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br></div></div><h2 id="测试" tabindex="-1">测试 <a class="header-anchor" href="#测试" aria-label="Permalink to &quot;测试&quot;">​</a></h2><div class="language- line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki material-theme-palenight vp-code" tabindex="0"><code><span class="line"><span>use admin</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br></div></div><div class="language- line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki material-theme-palenight vp-code" tabindex="0"><code><span class="line"><span>db.runCommand({&quot;enablesharding&quot;:&quot;sharedemodb&quot;})</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br></div></div><div class="language- line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki material-theme-palenight vp-code" tabindex="0"><code><span class="line"><span>sh.shardCollection(&quot;sharedemodb.student&quot;,{&quot;age&quot;:1})</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br></div></div><div class="language- line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki material-theme-palenight vp-code" tabindex="0"><code><span class="line"><span>sh.shardCollection(&quot;sharedemodb.human&quot;, {&quot;_id&quot;: &quot;hashed&quot; })</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br></div></div><div class="language- line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki material-theme-palenight vp-code" tabindex="0"><code><span class="line"><span>use sharedemodb</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br></div></div><div class="language- line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki material-theme-palenight vp-code" tabindex="0"><code><span class="line"><span>for (i = 1; i &lt;= 1000; i=i+1){db.student.insert({&#39;age&#39;: 38})}</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br></div></div><div class="language- line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki material-theme-palenight vp-code" tabindex="0"><code><span class="line"><span>for (i = 1; i &lt;= 1000; i=i+1){db.human.insert({&#39;age&#39;: 18})}</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br></div></div>',38),r=[i];function l(t,o,p,c,b,u){return s(),e("div",null,r)}const v=a(d,[["render",l]]);export{g as __pageData,v as default};
