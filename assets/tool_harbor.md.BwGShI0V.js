import{_ as a,c as s,o as e,a4 as n}from"./chunks/framework.CCJHkvW2.js";const m=JSON.parse('{"title":"docker-compose 安装harbor","description":"","frontmatter":{},"headers":[],"relativePath":"tool/harbor.md","filePath":"tool/harbor.md","lastUpdated":1707190539000}'),r={name:"tool/harbor.md"},l=n(`<h1 id="docker-compose-安装harbor" tabindex="-1">docker-compose 安装harbor <a class="header-anchor" href="#docker-compose-安装harbor" aria-label="Permalink to &quot;docker-compose 安装harbor&quot;">​</a></h1><p><a href="https://www.jianshu.com/p/7e44556ddc08" target="_blank" rel="noreferrer">文档参考地址1</a><br><a href="https://www.jianshu.com/p/05c719aa39c4" target="_blank" rel="noreferrer">文档参考地址2</a></p><h2 id="安装docker-compose" tabindex="-1">安装docker-compose <a class="header-anchor" href="#安装docker-compose" aria-label="Permalink to &quot;安装docker-compose&quot;">​</a></h2><div class="language- line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki material-theme-palenight vp-code" tabindex="0"><code><span class="line"><span>sudo curl -L &quot;https://github.com/docker/compose/releases/download/1.29.0/docker-compose-$(uname -s)-$(uname -m)&quot; -o /usr/local/bin/docker-compose</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br></div></div><h2 id="将可执行权限应用于二进制文件" tabindex="-1">将可执行权限应用于二进制文件： <a class="header-anchor" href="#将可执行权限应用于二进制文件" aria-label="Permalink to &quot;将可执行权限应用于二进制文件：&quot;">​</a></h2><div class="language- line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki material-theme-palenight vp-code" tabindex="0"><code><span class="line"><span>sudo chmod +x /usr/local/bin/docker-compose</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br></div></div><h2 id="创建软链" tabindex="-1">创建软链： <a class="header-anchor" href="#创建软链" aria-label="Permalink to &quot;创建软链：&quot;">​</a></h2><div class="language- line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki material-theme-palenight vp-code" tabindex="0"><code><span class="line"><span>sudo ln -s /usr/local/bin/docker-compose /usr/bin/docker-compose</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br></div></div><h2 id="验证安装" tabindex="-1">验证安装 <a class="header-anchor" href="#验证安装" aria-label="Permalink to &quot;验证安装&quot;">​</a></h2><div class="language- line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki material-theme-palenight vp-code" tabindex="0"><code><span class="line"><span>docker-compose --version</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br></div></div><h2 id="下载harbor" tabindex="-1">下载harbor <a class="header-anchor" href="#下载harbor" aria-label="Permalink to &quot;下载harbor&quot;">​</a></h2><div class="language- line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki material-theme-palenight vp-code" tabindex="0"><code><span class="line"><span>curl -o https://storage.googleapis.com/harbor-releases/release-1.9.0/harbor-offline-installer-v1.9.0.tgz</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br></div></div><h2 id="解压harbor" tabindex="-1">解压harbor <a class="header-anchor" href="#解压harbor" aria-label="Permalink to &quot;解压harbor&quot;">​</a></h2><div class="language- line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki material-theme-palenight vp-code" tabindex="0"><code><span class="line"><span>tar -xvf harbor-offline-installer-v1.9.0.tgz</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br></div></div><div class="tip custom-block"><p class="custom-block-title">修改harbor.yml</p><p>hostname 这里设置本机的ip</p><p>harbor_admin_password 登录密码</p><p>port 端口号</p></div><h2 id="运行" tabindex="-1">运行： <a class="header-anchor" href="#运行" aria-label="Permalink to &quot;运行：&quot;">​</a></h2><div class="language- line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki material-theme-palenight vp-code" tabindex="0"><code><span class="line"><span>sh ./install.sh</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br></div></div><h2 id="重启harbor" tabindex="-1">重启harbor <a class="header-anchor" href="#重启harbor" aria-label="Permalink to &quot;重启harbor&quot;">​</a></h2><p>cd 到harbor目录</p><div class="language- line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki material-theme-palenight vp-code" tabindex="0"><code><span class="line"><span>docker-compose stop</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br></div></div><div class="language- line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki material-theme-palenight vp-code" tabindex="0"><code><span class="line"><span>docker-compose up -d</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br></div></div><div class="tip custom-block"><p class="custom-block-title">出现问题</p><p>Get <a href="https://192.168.1.100:5000/v1/_ping:" target="_blank" rel="noreferrer">https://192.168.1.100:5000/v1/_ping:</a> http: server gave HTTP response to HTTPS client</p><p>在推送的服务器上（注意：不是harbor 服务器）”/etc/docker/“目录下，创建”daemon.json“文件。在文件中写入： 注意jenkins 服务器也要配置</p><div class="language-json line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">json</span><pre class="shiki material-theme-palenight vp-code" tabindex="0"><code><span class="line"><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#89DDFF;">&quot;</span><span style="color:#C792EA;">registry-mirrors</span><span style="color:#89DDFF;">&quot;</span><span style="color:#89DDFF;">:</span><span style="color:#89DDFF;"> [</span></span>
<span class="line"><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">https://2lqq34jg.mirror.aliyuncs.com</span><span style="color:#89DDFF;">&quot;</span><span style="color:#89DDFF;">,</span></span>
<span class="line"><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">https://pee6w651.mirror.aliyuncs.com</span><span style="color:#89DDFF;">&quot;</span><span style="color:#89DDFF;">,</span></span>
<span class="line"><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">https://registry.docker-cn.com</span><span style="color:#89DDFF;">&quot;</span><span style="color:#89DDFF;">,</span></span>
<span class="line"><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">http://hub-mirror.c.163.com</span><span style="color:#89DDFF;">&quot;</span><span style="color:#89DDFF;">,</span></span>
<span class="line"><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">https://nmp74w3y.mirror.aliyuncs.com</span><span style="color:#89DDFF;">&quot;</span></span>
<span class="line"><span style="color:#89DDFF;">],</span></span>
<span class="line"><span style="color:#89DDFF;">&quot;</span><span style="color:#C792EA;">dns</span><span style="color:#89DDFF;">&quot;</span><span style="color:#89DDFF;">:</span><span style="color:#89DDFF;"> [</span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">8.8.8.8</span><span style="color:#89DDFF;">&quot;</span><span style="color:#89DDFF;">,</span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">8.8.4.4</span><span style="color:#89DDFF;">&quot;</span><span style="color:#89DDFF;">],</span></span>
<span class="line"><span style="color:#89DDFF;">&quot;</span><span style="color:#C792EA;">insecure-registries</span><span style="color:#89DDFF;">&quot;</span><span style="color:#89DDFF;">:[</span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">172.26.25.7:8070</span><span style="color:#89DDFF;">&quot;</span><span style="color:#89DDFF;">,</span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">58.210.34.82:2007</span><span style="color:#89DDFF;">&quot;</span><span style="color:#89DDFF;">]</span></span>
<span class="line"><span style="color:#89DDFF;">}</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br></div></div><p>重启docker</p><div class="language- line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki material-theme-palenight vp-code" tabindex="0"><code><span class="line"><span>systemctl daemon-reload</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br></div></div><div class="language- line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki material-theme-palenight vp-code" tabindex="0"><code><span class="line"><span>systemctl restart docker</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br></div></div></div><div class="tip custom-block"><p class="custom-block-title">命令行登录harbor</p><div class="language- line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki material-theme-palenight vp-code" tabindex="0"><code><span class="line"><span>docker login --username=cheergoivan  --password=***** ip:port</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br></div></div><h2 id="清理harbor方式一" tabindex="-1">清理harbor方式一 <a class="header-anchor" href="#清理harbor方式一" aria-label="Permalink to &quot;清理harbor方式一&quot;">​</a></h2><p>df -h</p><h3 id="停止-harbor-服务" tabindex="-1">停止 Harbor 服务 <a class="header-anchor" href="#停止-harbor-服务" aria-label="Permalink to &quot;停止 Harbor 服务&quot;">​</a></h3><div class="language- line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki material-theme-palenight vp-code" tabindex="0"><code><span class="line"><span>docker-compose down</span></span>
<span class="line"><span>### 停止 Harbor 服务</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><h3 id="进入-sha256-目录" tabindex="-1">进入 sha256 目录 <a class="header-anchor" href="#进入-sha256-目录" aria-label="Permalink to &quot;进入 sha256 目录&quot;">​</a></h3><div class="language- line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki material-theme-palenight vp-code" tabindex="0"><code><span class="line"><span>cd /data/registry/docker/registry/v2/blobs/sha256/</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br></div></div><h3 id="查看大小" tabindex="-1">查看大小 <a class="header-anchor" href="#查看大小" aria-label="Permalink to &quot;查看大小&quot;">​</a></h3><div class="language- line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki material-theme-palenight vp-code" tabindex="0"><code><span class="line"><span>du -h --max-depth=1 .</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br></div></div><h3 id="删除-sha256-目录下所有文件" tabindex="-1">删除 sha256 目录下所有文件 <a class="header-anchor" href="#删除-sha256-目录下所有文件" aria-label="Permalink to &quot;删除 sha256 目录下所有文件&quot;">​</a></h3><div class="language- line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki material-theme-palenight vp-code" tabindex="0"><code><span class="line"><span>rm -rf ./*</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br></div></div><h3 id="重启-harbor-服务" tabindex="-1">重启 Harbor 服务 <a class="header-anchor" href="#重启-harbor-服务" aria-label="Permalink to &quot;重启 Harbor 服务&quot;">​</a></h3><div class="language- line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki material-theme-palenight vp-code" tabindex="0"><code><span class="line"><span>docker-compose -d</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br></div></div><h2 id="清理harbor方式二" tabindex="-1">清理harbor方式二 <a class="header-anchor" href="#清理harbor方式二" aria-label="Permalink to &quot;清理harbor方式二&quot;">​</a></h2><h3 id="进入导harbor-yaml文件所在目录" tabindex="-1">进入导harbor yaml文件所在目录 <a class="header-anchor" href="#进入导harbor-yaml文件所在目录" aria-label="Permalink to &quot;进入导harbor yaml文件所在目录&quot;">​</a></h3><div class="language- line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki material-theme-palenight vp-code" tabindex="0"><code><span class="line"><span>cd /root/harbor</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br></div></div><h3 id="停止harbor" tabindex="-1">停止harbor <a class="header-anchor" href="#停止harbor" aria-label="Permalink to &quot;停止harbor&quot;">​</a></h3><div class="language- line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki material-theme-palenight vp-code" tabindex="0"><code><span class="line"><span>docker-compose stop</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br></div></div><h3 id="使用清理镜像进行垃圾回收-使用-dry-run-参数进行预览-不使用则进行清理" tabindex="-1">使用清理镜像进行垃圾回收 使用--dry-run 参数进行预览，不使用则进行清理 <a class="header-anchor" href="#使用清理镜像进行垃圾回收-使用-dry-run-参数进行预览-不使用则进行清理" aria-label="Permalink to &quot;使用清理镜像进行垃圾回收 使用--dry-run 参数进行预览，不使用则进行清理&quot;">​</a></h3><div class="language- line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki material-theme-palenight vp-code" tabindex="0"><code><span class="line"><span>docker run -it --name gc --rm --volumes-from registry vmware/registry:2.6.2-photon garbage-collect  /etc/registry/config.yml</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br></div></div><h3 id="重新启动harbor" tabindex="-1">重新启动harbor <a class="header-anchor" href="#重新启动harbor" aria-label="Permalink to &quot;重新启动harbor&quot;">​</a></h3><div class="language- line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki material-theme-palenight vp-code" tabindex="0"><code><span class="line"><span>docker-compose start</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br></div></div><h3 id="运行-1" tabindex="-1">运行： <a class="header-anchor" href="#运行-1" aria-label="Permalink to &quot;运行：&quot;">​</a></h3><div class="language- line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki material-theme-palenight vp-code" tabindex="0"><code><span class="line"><span>sh ./install.sh</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br></div></div></div>`,23),o=[l];function p(i,t,c,d,b,h){return e(),s("div",null,o)}const v=a(r,[["render",p]]);export{m as __pageData,v as default};
